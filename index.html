

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a73e8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HbeeBuzz">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU2NvdXRpZXIgLSBFbWFpbCBPdXRyZWFjaCIsInNob3J0X25hbWUiOiJTY291dGllciIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZjhmOWZhIiwidGhlbWVfY29sb3IiOiIjMWE3M2U4IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBRkFBQUFCUUNBSUFBQUNXMDFTSkFBQUFFRWxFUVZSWUdLM1o1MVlSS3dBVkFBQUEiLCJzaXplcyI6IjgweDgwIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BGZ0365NTS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-BGZ0365NTS');
    </script>
  
    <!-- Primary Meta Tags -->
    <title>HbeeBuzz - Advanced Bulk Email Outreach Tool PWA</title>
    <meta name="description" content="HbeeBuzz is a lightning-fast PWA email outreach tool that works offline. Send personalized emails in bulk with smart automation and scheduling.">
    <meta name="keywords" content="HbeeBuzz, email outreach, bulk emails, PWA, offline email tool, email automation">
    <meta name="author" content="HbeeBuzz Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:title" content="HbeeBuzz - PWA Bulk Email Outreach Tool">
    <meta property="og:description" content="Lightning-fast PWA for bulk email outreach. Works offline with smart automation and scheduling features.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.hbeebuzz.com.ng">
    <meta property="og:image" content="https://www.hbeebuzz.com.ng/assets/images/hbeebuzz-og-image.png">
    <meta property="og:site_name" content="HbeeBuzz">
    
    <!-- Twitter Cards Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="HbeeBuzz - PWA Email Outreach Tool">
    <meta name="twitter:description" content="Lightning-fast PWA for bulk email outreach with offline capabilities and smart automation.">
    <meta name="twitter:image" content="https://www.hbeebuzz.com.ng/assets/images/hbeebuzz-twitter-image.png">
    <meta name="twitter:site" content="@hbeebuzz">
    <meta name="twitter:creator" content="@hbeebuzz">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.hbeebuzz.com.ng">

    <!-- Favicon -->
    <link rel="icon" href="https://res.cloudinary.com/dib5bkbsy/image/upload/v1732499785/icons8-mail-32_z9jaip.png" type="image/x-icon">

    <!-- Remixicon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">

    <!-- Added Google Sans font -->
    
    
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
   
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        blue: {
                            500: '#1a73e8',
                            600: '#0d62d0'
                        },
                        green: {
                            500: '#34a853'
                        },
                        yellow: {
                            500: '#fbbc05'
                        },
                        red: {
                            500: '#ea4335'
                        },
                        purple: {
                            500: '#8c5eff'
                        }
                    },
                    fontFamily: {
                        'google-sans': ['Google Sans', 'system-ui', '-apple-system', 'sans-serif'],
                        ubuntu: ['Google Sans', 'system-ui', 'sans-serif'],
                        lato: ['Google Sans', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
    :root {
      --blue-500: #1a73e8;
      --green: #34a853;
      --yellow: #fbbc05;
      --red-500: #ea4335;
      --purple-500: #8c5eff;
      --gray-100: #f5f5f5;
      --gray-200: #e5e5e5;
      --gray-300: #d4d4d4;
      --gray-700: #4a4a4a;
      --gray-800: #333333;
      --gray-900: #222222;
    }
    
    /* Optimized base styling */
    body {
      font-family: 'Google Sans', system-ui, -apple-system, sans-serif;
      font-size: 12px;
      font-weight: 300;
      line-height: 1.5;
      color: #202124;
      background-color: #f8f9fa;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Google Sans', system-ui, -apple-system, sans-serif;
      font-weight: 400;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    h1 { font-size: 2rem; font-weight: 700; }
    h2 { font-size: 1.5rem; font-weight: 600; }
    h3 { font-size: 1.25rem; font-weight: 600; }
    h4 { font-size: 1.125rem; font-weight: 500; }
  
    .dark-custom-bg { background-color: #202124; }
    .dark .bg-card { background-color: #202124; }

    /* Ultra-lightweight scrollbar */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.2); border-radius: 2px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.3); }
    .dark ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); }
    .dark ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.3); }
    
    /* Lightning-fast email links */
    .email-link {
      padding: 3px 5px;
      border-radius: 4px;
      margin-bottom: 2px;
      font-size: 12px;
      font-weight: 400;
      transition: background-color 0.1s ease;
      display: block;
    }
      
    /* Optimized button styles */
    .gmail-btn {
      background-color: var(--blue-500);
      color: white;
      border-radius: 6px;
      font-family: 'Google Sans', system-ui, sans-serif;
      font-weight: 500;
      font-size: 14px;
      letter-spacing: 0.01em;
      text-transform: none;
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.15);
      transition: all 0.15s ease;
      border: none;
      cursor: pointer;
    }

    .gmail-btn:hover {
      background-color: #0d62d0;
      transform: translateY(-1px);
    }
    
    .gmail-btn:active { transform: translateY(0); }
    .gmail-btn:disabled {
      background-color: #dadce0;
      color: #5f6368;
      cursor: not-allowed;
      transform: none;
    }
    
    .gmail-btn-secondary {
      background-color: white;
      color: var(--blue-500);
      border: 1px solid #dadce0;
      font-family: 'Google Sans', system-ui, sans-serif;
      font-weight: 500;
      transition: all 0.15s ease;
    }
    
    .gmail-btn-secondary:hover {
      background-color: #f8f9fa;
      border-color: var(--blue-500);
    }
    
    .dark .gmail-btn-secondary {
      background-color: #2d2e30;
      color: #8ab4f8;
      border-color: #5f6368;
    }
    
    .dark .gmail-btn-secondary:hover {
      background-color: #3c4043;
      border-color: #8ab4f8;
    }
    
    /* Ultra-fast focus effects */
    .focus-effect:focus {
      border-color: var(--blue-500) !important;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.12);
      outline: none;
    }

    /* Optimized theme slider */
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #dadce0;
      transition: all 0.2s ease;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: all 0.2s ease;
      border-radius: 50%;
    }

    input:checked + .slider { background-color: var(--blue-500); }
    input:checked + .slider:before { transform: translateX(26px); }

    #themeMenu { transition: all 0.15s ease; }
   
    /* Optimized textarea */
    textarea {
      font-family: 'Google Sans', system-ui, sans-serif;
      font-size: 14px;
      line-height: 1.5;
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    }

    .dark textarea { scrollbar-color: rgba(255, 255, 255, 0.2) transparent; }
    
    /* Lightning-fast card styling */
    .gmail-card {
      background-color: white;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.04);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      transition: box-shadow 0.2s ease;
    }
    
    .gmail-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
    .dark .gmail-card {
      background-color: #2d2e30;
      border-color: rgba(255, 255, 255, 0.06);
    }

    /* Optimized input styling */
    .gmail-input {
      border-radius: 8px;
      border: 1px solid #dadce0;
      padding: 10px 14px;
      font-family: 'Google Sans', system-ui, sans-serif;
      font-size: 14px;
      font-weight: 400;
      transition: all 0.15s ease;
      background-color: white;
    }
    
    .gmail-input:focus {
      border-color: var(--blue-500);
      outline: none;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.12);
    }
    
    .dark .gmail-input {
      border-color: #5f6368;
      background-color: #2d2e30;
      color: #e8eaed;
    }
    

    
    /* Optimized template chips */
    .template-chip {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      background-color: #f0f4f9;
      color: var(--blue-500);
      border-radius: 20px;
      font-family: 'Google Sans', system-ui, sans-serif;
      font-size: 13px;
      font-weight: 500;
      margin-right: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.15s ease;
      border: 1px solid transparent;
    }
    
    .template-chip:hover {
      background-color: #e4ebf5;
      border-color: var(--blue-500);
    }
    
    .dark .template-chip {
      background-color: #3c4043;
      color: #8ab4f8;
    }
    
    .dark .template-chip:hover {
      background-color: #4a4e51;
      border-color: #8ab4f8;
    }
    
    /* Super-fast floating button */
    .floating-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: var(--blue-500);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
      cursor: pointer;
      transition: all 0.2s ease;
      z-index: 100;
      opacity: 0;
      transform: scale(0);
      border: none;
    }
    
    .floating-btn.visible {
      opacity: 1;
      transform: scale(1);
    }
    
    .floating-btn:hover {
      background-color: #0d62d0;
      transform: scale(1.05);
    }
    
    /* Email validation indicators */
    .validation-indicator {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 12px;
      font-family: 'Google Sans', system-ui, sans-serif;
      font-size: 12px;
      font-weight: 500;
      margin-right: 8px;
    }
    
    .validation-good {
      background-color: rgba(52, 168, 83, 0.1);
      color: #34a853;
    }
    
    .validation-bad {
      background-color: rgba(234, 67, 53, 0.1);
      color: #ea4335;
    }
    
    .dark .validation-good { background-color: rgba(52, 168, 83, 0.2); }
    .dark .validation-bad { background-color: rgba(234, 67, 53, 0.2); }
    
    /* Ultra-fast animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .animate-fadeIn { animation: fadeIn 0.2s ease forwards; }
    .animate-slideIn { animation: slideIn 0.2s ease forwards; }
    
    /* Performance optimizations */
    .email-container {
      contain: layout style paint;
      
    }
    
    .smooth-scroll {
      transform: translateZ(0);
      scroll-behavior: smooth;
    }

 

    /* Lightning-fast loading states */
    .loading-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .dark .loading-skeleton {
      background: linear-gradient(90deg, #2a2a2a 25%, #3a3a3a 50%, #2a2a2a 75%);
      background-size: 200% 100%;
    }

    /* Global progress bar */
    #globalProgressBar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: #e0e0e0;
      z-index: 9999;
      transform: translateY(-100%);
      transition: transform 0.2s ease;
    }
    #globalProgressBar.show { transform: translateY(0); }
    #globalProgressBar .progress-bar {
      height: 100%;
      width: 0%;
      background-color: var(--green);
      transition: width 0.1s linear;
    }

    /* Email links multi-select */
    .email-link.selected {
      background-color: rgba(26, 115, 232, 0.1);
      border-left: 3px solid var(--blue-500);
      padding-left: 3px;
    }

    /* Search bar styles */
    .search-container {
      background: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(52, 168, 83, 0.05));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(26, 115, 232, 0.1);
    }

    /* Automation panel */
    .automation-panel {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    /* Smart suggestion chips */
    .smart-chip {
      background: linear-gradient(135deg, #ff9a56, #ff6b6b);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      margin: 4px;
    }

    .smart-chip:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3); }

    /* PWA Installation prompt */
    .install-prompt {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Offline indicator */
    .offline-indicator {
      position: fixed;
      top: 60px;
      right: 20px;
      background: #ff6b6b;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 12px;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }

    .offline-indicator.show { transform: translateX(0); }

    /* Quick actions toolbar */
    .quick-actions {
      position: fixed;
      top: 50%;
      right: -200px;
      transform: translateY(-50%);
      background: white;
      border-radius: 12px 0 0 12px;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
      padding: 12px 8px;
      transition: right 0.3s ease;
      z-index: 90;
    }

    .quick-actions.show { right: 0; }
    .dark .quick-actions { background: #2d2e30; }

    /* Performance metrics */
    .perf-meter {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: conic-gradient(#34a853 0deg 120deg, #fbbc05 120deg 240deg, #ea4335 240deg 360deg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .perf-meter::before {
      content: '';
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: white;
      position: absolute;
    }

    .dark .perf-meter::before { background: #2d2e30; }
    
    /* 24h Tracker Styles */
#24hProgressBar {
  transition: width 0.3s ease;
}

#summaryPanel {
  animation: slideIn 0.2s ease forwards;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

#summaryPanel.show {
  max-height: 300px;
}
    </style>
    
    <style>
  .scrolling-text {
    width: 100%;
    overflow: hidden;
  }
  .scrolling-text p {
    animation: scroll-left 15s linear infinite;
  }
  @keyframes scroll-left {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
</style>
   
<link rel="me" href="https://www.blogger.com/profile/03086539832299890802" />
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

<script type="text/javascript" language="javascript">
  // Supply ads personalization default for EEA readers
  // See https://www.blogger.com/go/adspersonalization
  adsbygoogle = window.adsbygoogle || [];
  if (typeof adsbygoogle.requestNonPersonalizedAds === 'undefined') {
    adsbygoogle.requestNonPersonalizedAds = 1;
  }
</script>

<style>

    /* V2 code editor & preview styles */
    .code-editor {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      min-height: 120px;
      white-space: pre-wrap;
    }
    .render-preview {
      min-height: 120px;
    }

</style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen flex flex-col">

    <!-- Global Progress Bar -->
    <div id="globalProgressBar">
        <div class="progress-bar"></div>
    </div>

    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="ri-wifi-off-line mr-2"></i>
        Working Offline
    </div>

    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="install-prompt fixed top-4 left-4 right-4 mx-auto max-w-md z-50 hidden">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i class="ri-download-cloud-line text-xl mr-3"></i>
                <div>
                    <div class="font-semibold">Install HbeeBuzz</div>
                    <div class="text-sm opacity-90">Get the full app experience</div>
                </div>
            </div>
            <div class="flex gap-2">
                <button id="installBtn" class="bg-white text-purple-600 px-4 py-2 rounded-lg text-sm font-medium">Install</button>
                <button id="dismissInstall" class="text-white opacity-75 hover:opacity-100">
                    <i class="ri-close-line text-xl"></i>
                </button>
            </div>
        </div>
    </div>

<!-- Header Section -->
<header class="bg-white dark:bg-gray-800 py-4 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50">
  <div class="container mx-auto flex justify-between items-center px-4 md:px-6">

    <!-- Branding Section -->
    <div class="flex items-center space-x-4">
      <div class="flex items-center space-x-3">
        <img src="https://res.cloudinary.com/dib5bkbsy/image/upload/v1732499785/icons8-mail-32_z9jaip.png" alt="HbeeBuzz Logo" class="w-6 h-6">
        <h1 class="text-2xl font-bold" style="color:#4CAF50;">HbeeBuzz</h1>
        <span class="text-xs px-2 py-1 rounded-full font-medium" style="background-color:#FF5722; color:#FFEB3B;">
          PWA
        </span>
      </div>
    </div>


      <!-- Social Links & Performance -->
      <div class="flex justify-center items-center gap-4">
        <div class="perf-meter hidden md:flex">
          <span id="perfScore" class="text-xs font-bold z-10">98</span>
        </div>
        <a href="https://www.x.com/justeldev" class="text-black dark:text-gray-400 hover:text-blue-500 transition-all p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
          <i class="ri-twitter-x-fill text-xl"></i>
        </a>
      </div>
      
      <!-- Stats & Theme Toggle -->
      <div class="flex items-center space-x-4">
        <div class="hidden md:flex items-center space-x-6 mr-4">
          <div class="flex items-center space-x-2">
            <i class="ri-check-double-line text-green-500"></i>
            <span class="text-sm font-medium"><span id="headerSentCount" class="font-semibold">0</span> sent</span>
          </div>
          <div class="flex items-center space-x-2">
            <i class="ri-time-line text-blue-500"></i>
            <span class="text-sm font-medium"><span id="headerRemainingCount" class="font-semibold">0</span> pending</span>
          </div>
        </div>

        <div class="relative">
          <button id="darkModeToggle" class="text-blue-500 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-all p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="ri-moon-line ri-lg hidden" id="darkIcon"></i>
            <i class="ri-sun-line ri-lg" id="lightIcon"></i>
          </button>

          <ul id="themeMenu" class="absolute right-0 top-11 mt-2 w-48 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 shadow-lg rounded-lg opacity-0 invisible transition-all duration-300 z-50 border border-gray-200 dark:border-gray-700">
            <li data-theme="system" class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded-t-lg flex items-center gap-2">
              <i class="ri-device-line text-green-500"></i> System
            </li>
            <li data-theme="light" class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer flex items-center gap-2">
              <i class="ri-sun-line text-yellow-500"></i> Light
            </li>
            <li data-theme="dark" class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded-b-lg flex items-center gap-2">
              <i class="ri-moon-line text-blue-500"></i> Dark
            </li>
          </ul>
        </div>
      </div>
    </div>
  </header>


<!-- Announcement Bar Section -->
<section class="bg-orange-50 border border-orange-200 rounded-xl text-orange-700 p-2 text-center flex items-center justify-between mx-2 mt-3 shadow-sm">
  
  <!-- Icon + Scrolling Text -->
  <div class="flex items-center overflow-hidden">
    <i class="ri-megaphone-line text-lg mr-2 text-orange-500"></i>
    <div class="scrolling-text whitespace-nowrap">
      <p id="announcementText" class="inline-block px-2">
       HbeeBuzz Update <i class="ri-alert-line text-red-500"></i>: Now works offline with PWA, global email search, AI commands, smart automation, spam check, live activity, and reset campaign features.
      </p>
    </div>
  </div>

  <!-- Copy Button -->
  <button onclick="copyAnnouncement()" 
          class="ml-3 px-2 py-1 rounded-lg text-sm flex items-center gap-1 text-orange-600 hover:bg-orange-100 transition">
    <i class="ri-file-copy-line"></i> Copy
  </button>
</section>



<script>
  function copyAnnouncement() {
    const text = document.getElementById("announcementText").innerText;
    navigator.clipboard.writeText(text).then(() => {
      alert("Announcement copied!");
    });
  }
</script>

<!-- Search Bar Section -->
<div class="search-container py-4 sticky top-16 z-40">
  <div class="container mx-auto px-4">
    <div class="relative max-w-2xl mx-auto">
      <div class="flex items-center border border-gray-300 dark:border-gray-600 rounded-xl overflow-hidden shadow-sm focus-within:ring-2 focus-within:ring-blue-500 transition-all bg-white dark:bg-gray-800">
        <i class="ri-search-line px-4 text-gray-400 dark:text-gray-500 text-xl flex-shrink-0"></i>
        
        <input 
          type="text" 
          id="globalEmailSearch" 
          placeholder="Search emails globally or use AI commands..." 
          class="flex-1 min-w-0 px-3 py-4 bg-transparent focus:outline-none text-gray-700 dark:text-gray-300 focus-effect"
        />
        
        <div class="px-3 flex items-center space-x-2 flex-shrink-0">
          <button id="aiAssistBtn" class="smart-chip">
            <i class="ri-sparkling-line mr-1"></i> AI
          </button>
          
        </div>
      </div>
      
      <!-- Search Suggestions -->
      <div id="searchSuggestions" class="absolute top-full left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg mt-2 hidden z-50">
        <div class="p-4 space-y-2">
          <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">AI Commands</div>
          <button class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" data-command="find:gmail">Find all Gmail addresses</button>
          <button class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" data-command="sort:domain">Sort by domain</button>
          <button class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" data-command="filter:unsent">Show only unsent</button>
          <button class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" data-command="export:csv">Export as CSV</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions Toolbar -->
<div id="quickActions" class="quick-actions">
  <div class="flex flex-col gap-3">
    <button id="quickSchedule" class="p-3 rounded-full bg-purple-500 text-white hover:bg-purple-600 transition-colors" title="Quick Schedule">
      <i class="ri-calendar-schedule-line"></i>
    </button>
    <button id="quickExport" class="p-3 rounded-full bg-green-500 text-white hover:bg-green-600 transition-colors" title="Quick Export">
      <i class="ri-download-cloud-line"></i>
    </button>
    <button id="quickStats" class="p-3 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors" title="Quick Stats">
      <i class="ri-bar-chart-line"></i>
    </button>
    <button id="toggleQuickActions" class="p-2 rounded-full bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300">
      <i class="ri-arrow-right-line" id="quickActionsIcon"></i>
    </button>
  </div>
</div>


  <!-- Main Container -->
  <div class="container mx-auto px-4 flex-grow py-6">

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      
      <!-- Left Column (3/4) -->
      <div class="lg:col-span-3 space-y-6">

       

        <!-- Main Tool Form -->
        <div class="gmail-card p-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold flex items-center gap-2 text-green-500 dark:text-gray-100">
              <i class="ri-send-plane-fill text-red-500"></i>
              Fast Mail Send
            </h2>
            <div class="flex items-center gap-2">
              <span class="text-sm text-blue-500 dark:text-blue-400 font-medium">Status:</span>
              <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            </div>
          </div>

          <form id="emailForm" class="space-y-5">
            <!-- Recipients Section -->
            <div>
              <label for="recipients" class="block text-sm font-medium flex items-center gap-2 text-gray-700 dark:text-gray-300 mb-2">
                <i class="ri-mail-line text-blue-500"></i>
                Recipients Email <small class="ml-2 text-xs text-gray-500 dark:text-gray-400">(Max 10,000)</small>
                <button type="button" id="smartExtract" class="smart-chip ml-auto text-xs">
                  <i class="ri-magic-line mr-1"></i> AI Smart Fix
                </button>
              </label>
              <div class="relative">
                <textarea
                  id="recipients"
                  class="w-full gmail-input resize-none focus-effect"
                  rows="5"
                  placeholder="Enter each email on a new line or paste mixed content for smart extraction"
                  required
                ></textarea>
                <div class="absolute bottom-2 right-2 flex gap-2">
                  <button type="button" id="clearRecipients" class="text-xs text-red-500 hover:text-red-700">
                    <i class="ri-close-circle-line"></i> Clear
                  </button>
                  <button type="button" id="validateEmails" class="text-xs text-blue-500 hover:text-blue-700">
                    <i class="ri-shield-check-line"></i> Validate
                  </button>
                </div>
              </div>
              
              <div class="flex flex-wrap items-center mt-2 text-xs text-gray-600 dark:text-gray-400">
                <div id="validEmailsIndicator" class="validation-indicator validation-good mr-2 mb-1">
                  <i class="ri-checkbox-circle-line mr-1"></i>
                  <span>Valid: <span id="validEmails" class="font-medium">0</span></span>
                </div>
                <div id="invalidEmailsIndicator" class="validation-indicator validation-bad mr-2 mb-1">
                  <i class="ri-error-warning-line mr-1"></i>
                  <span>Invalid: <span id="invalidEmails" class="font-medium">0</span></span>
                </div>
                <div class="mr-2 mb-1">
                  <span>Total: <span id="totalEmails" class="font-medium">0</span></span>
                </div>
                <div class="mr-2 mb-1">
                  <span>Duplicates: <span id="duplicateEmails" class="font-medium text-yellow-600">0</span></span>
                </div>
              </div>
            </div>

            <!-- Subject Section -->
            <div>
              <label for="subject" class="block text-sm font-medium flex items-center gap-2 text-gray-700 dark:text-gray-300 mb-2">
                <i class="ri-pencil-line text-yellow-500"></i>
                Subject Line <small class="ml-2 text-xs text-gray-500 dark:text-gray-400">(Max 200 characters)</small>
                
              </label>
              <input
                type="text"
                id="subject"
                class="w-full gmail-input focus-effect"
                placeholder="Email Subject - Use {name} for personalization"
              />
              
              <!-- Subject Templates -->
              <div class="flex flex-wrap mt-2">
                <div class="template-chip" data-target="subject" data-template="Quick question about {company}">
                  <i class="ri-question-line mr-1"></i> Quick question
                </div>
                <div class="template-chip" data-target="subject" data-template="Partnership opportunity with {name}">
                  <i class="ri-handshake-line mr-1"></i> Partnership
                </div>
                <div class="template-chip" data-target="subject" data-template="Exclusive offer for {company}">
                  <i class="ri-gift-line mr-1"></i> Exclusive offer
                </div>
              </div>
              
              <div class="flex justify-between mt-1">
                <div class="flex gap-2">
                <button type="button" id="subjectAnalyzer" class="gmail-btn-secondary py-1 px-3 text-xs flex items-center gap-1 relative">
  <i class="ri-search-eye-line"></i> Analyze
  <span class="absolute -top-2 -right-2 text-[10px] font-bold bg-gradient-to-r from-green-400 to-blue-500 text-transparent bg-clip-text">
    NEW
  </span>
</button>

<button type="button" id="spamChecker" class="gmail-btn-secondary py-1 px-3 text-xs flex items-center gap-1 relative">
  <i class="ri-shield-line"></i> Spam Check
  <span class="absolute -top-2 -right-2 text-[10px] font-bold bg-gradient-to-r from-pink-500 to-yellow-500 text-transparent bg-clip-text">
    NEW
  </span>
</button>
                </div>
                <span id="subjectCount" class="text-xs text-gray-500 dark:text-gray-400">0/200</span>
              </div>
            </div>

            <!-- Message Body Section -->

            <!-- Message Composer: Text | Code | Preview (REPLACED V2) -->
            <div>
              <label class="block text-sm font-medium mb-2">Message Body <span class="text-xs text-gray-400">(Text / HTML supported)</span></label>

              <!-- Tabs -->
              <div class="inline-flex bg-gray-100 rounded-full p-1 mb-3" role="tablist" aria-label="Message modes">
                <button id="tabText" class="px-3 py-1 rounded-full bg-white text-sm font-medium shadow-sm" data-mode="text">✍️ Text</button>
                <button id="tabCode" class="px-3 py-1 rounded-full text-sm font-medium text-gray-600" data-mode="code">&lt;/&gt; Code</button>
                <button id="tabPreview" class="px-3 py-1 rounded-full text-sm font-medium text-gray-600" data-mode="preview">👁 Preview</button>
              </div>

              <!-- Text mode -->
              <textarea id="bodyText" class="w-full gmail-input border rounded-lg p-3 code-editor" rows="6" placeholder="Write a plain text message..."></textarea>

              <!-- Code mode -->
              <textarea id="bodyCode" class="w-full gmail-input border rounded-lg p-3 code-editor hidden" rows="6" placeholder="Paste full HTML here..."></textarea>

              <!-- Render preview -->
              <div id="bodyPreview" class="w-full gmail-card render-preview hidden bg-white mt-2 p-3"></div>

              <!-- Hidden input used as form payload -->
              <input type="hidden" id="bodyValue" name="body">
              <div class="flex items-center justify-between mt-2 text-xs text-gray-500">
                <div id="bodyCharCount">0 chars</div>
                <div class="flex gap-2">
                  <button id="insertTemplate" type="button" class="text-sm text-blue-600 hover:underline">Insert Template</button>
                </div>
              </div>
            </div>

            <!-- Advanced Options -->
            <div class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4">
              <div class="flex items-center justify-between mb-3">
                <h4 class="font-medium text-gray-800 dark:text-gray-200 relative inline-block">
  Advanced Options
  <span class="absolute -top-2 -right-6 text-[10px] font-bold bg-gradient-to-r from-pink-500 to-red-500 text-transparent bg-clip-text">
    NEW
  </span>
</h4>
<button type="button" id="toggleAdvanced" class="text-xs text-blue-500 hover:text-blue-700">
  <i class="ri-arrow-down-s-line" id="advancedIcon"></i> Expand
</button>
              </div>
              <div id="advancedOptions" class="hidden space-y-4">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
     
     <!-- Instruction Block -->
<div class="bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-400 p-3 mb-3 rounded">
  <div class="flex items-start gap-2 text-sm text-gray-700 dark:text-gray-300">
    <i class="ri-information-line text-yellow-500 dark:text-yellow-300 text-lg"></i>
    <p>
      To use this feature, first scroll down and enable 
      <span class="font-medium text-gray-800 dark:text-gray-100">"Enable Auto-Send"</span>.  
      After enabling, allow pop-ups in your browser.  
      Then return here, customize the settings, and click 
      <span class="font-medium text-gray-800 dark:text-gray-100">"Generate Emails"</span>.  
      Emails will send automatically without manual clicks.
    </p>
  </div>
</div>
      <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Send Interval (seconds)</label>
      <input type="number" id="sendInterval" class="gmail-input w-full" value="10" min="1" max="300">
    </div>

    <div>
      <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Batch Size</label>
      <input type="number" id="batchSize" class="gmail-input w-full" value="50" min="10" max="500">
    </div>

    <div>
      <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Priority Mode</label>
      <select id="priorityMode" class="gmail-input w-full">
        <option value="normal">Normal</option>
        <option value="high">High Priority</option>
        <option value="low">Low Priority</option>
      </select>
    </div>

    <div>
      <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Auto-pause at</label>
      <input type="number" id="autoPause" class="gmail-input w-full" placeholder="e.g., 100 emails" min="1">
    </div>
  </div>

  <div class="flex items-center gap-4">
    <label class="flex items-center gap-2 cursor-pointer">
      <input type="checkbox" id="skipDuplicates" checked class="w-4 h-4 text-blue-500 rounded">
      <span class="text-sm text-gray-700 dark:text-gray-300">Skip duplicate emails</span>
    </label>
    <label class="flex items-center gap-2 cursor-pointer">
      <input type="checkbox" id="trackOpens" class="w-4 h-4 text-blue-500 rounded">
      <span class="text-sm text-gray-700 dark:text-gray-300">Track email opens</span>
    </label>
    <label class="flex items-center gap-2 cursor-pointer">
      <input type="checkbox" id="autoRetry" class="w-4 h-4 text-blue-500 rounded">
      <span class="text-sm text-gray-700 dark:text-gray-300">Auto-retry failed</span>
    </label>
  </div>
</div>
</div>

           <!-- Preview and Test Buttons -->
<div class="flex gap-4 w-full">
  <button type="button" id="previewEmail" class="gmail-btn-secondary py-3 px-4 rounded-lg flex-1 flex items-center justify-center gap-2 relative">
  <i class="ri-eye-line"></i> Preview
  <span class="absolute -top-2 -right-2 text-[10px] font-bold bg-gradient-to-r from-green-400 to-blue-500 text-transparent bg-clip-text">
    NEW
  </span>
</button>

<button type="button" id="sendTestEmail" class="gmail-btn-secondary py-3 px-4 rounded-lg flex-1 flex items-center justify-center gap-2 relative">
  <i class="ri-test-tube-line"></i> Test
  <span class="absolute -top-2 -right-2 text-[10px] font-bold bg-gradient-to-r from-pink-500 to-yellow-500 text-transparent bg-clip-text">
    NEW
  </span>
</button>
  
</div>


        
            <!-- Submit Button -->
            <button type="submit" class="w-full gmail-btn py-3 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all flex items-center justify-center gap-2 text-lg font-semibold">
              <i class="ri-rocket-line text-xl"></i>
              Generate Emails
            </button>
          </form>
        </div>

        <!-- File Upload Section -->
        <div class="gmail-card p-6">
          <h4 class="text-lg font-medium flex items-center gap-2 mb-3 text-green-500 dark:text-gray-100">
            <i class="ri-upload-cloud-line text-red-500 text-xl"></i>
            Smart File Upload
          </h4>

          <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
            Upload CSV, TXT, or Excel files. AI will automatically extract and clean email addresses.
          </p>

          <div class="flex items-start gap-2 text-sm text-gray-700 dark:text-gray-300 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-yellow-500 rounded-r-lg p-3 mb-5">
            <i class="ri-lightbulb-flash-line text-lg mt-0.5 text-yellow-500"></i>
            <p>
              <strong>Pro Tips:</strong> Mixed content is supported! Paste emails, names, or any text - AI will extract valid emails automatically. Maximum 20,000 emails per batch for optimal performance.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <label for="csvUpload" class="cursor-pointer gmail-btn-secondary py-3 px-4 rounded-lg transition-all flex items-center gap-2 justify-center hover:scale-105">
              <i class="ri-file-add-line text-blue-500"></i> Choose File
            </label>
            <input type="file" id="csvUpload" class="hidden" accept=".csv,.txt,.xlsx,.xls" />
            
            <div id="fileName" class="text-sm truncate flex items-center text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-3 py-3 rounded-lg">
              <i class="ri-file-line mr-2"></i>
              No file selected
            </div>

            <button id="uploadCSV" class="gmail-btn py-3 px-4 rounded-lg transition-all flex items-center gap-2 justify-center hover:scale-105">
              <i class="ri-upload-cloud-line"></i>
              Smart Upload
            </button>
          </div>
        </div>
        
        <!-- Email Templates Section -->
        <div class="gmail-card p-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-lg font-medium flex items-center gap-2 text-blue-500 dark:text-gray-100">
              <i class="ri-file-list-3-line text-blue-500"></i>
              Smart Templates
            </h4>
            
          </div>
          
          <div id="templatesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- AI-Enhanced Templates -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-blue-300 dark:hover:border-blue-700 transition-all cursor-pointer bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20" data-template-subject="Smart follow-up with {name}" data-template-body="Hi {name},&#10;&#10;I hope you're doing well at {company}. I'm following up on our previous conversation about potential collaboration opportunities.&#10;&#10;Based on your recent achievements, I believe we could create something amazing together. Would you have 15 minutes this week for a quick call?&#10;&#10;Looking forward to hearing from you.&#10;&#10;Best regards,&#10;[Your Name]">
              <div class="flex justify-between items-start mb-2">
                <h5 class="font-medium text-gray-800 dark:text-gray-200">AI-Enhanced Follow-up</h5>
                <span class="text-xs bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2 py-0.5 rounded">AI Optimized</span>
              </div>
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-3 line-clamp-2">Smart follow-up with personalization and engagement hooks.</p>
              <button class="text-xs text-blue-500 hover:text-blue-700 dark:hover:text-blue-300 flex items-center">
                <i class="ri-sparkling-line mr-1"></i> Use AI Template
              </button>
            </div>
            
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-blue-300 dark:hover:border-blue-700 transition-all cursor-pointer bg-gradient-to-br from-green-50 to-yellow-50 dark:from-green-900/20 dark:to-yellow-900/20" data-template-subject="Exclusive opportunity for {company}" data-template-body="Dear {name},&#10;&#10;I've been following {company}'s impressive growth in the industry, and I'm excited to share an exclusive opportunity that aligns perfectly with your goals.&#10;&#10;Our latest solution has helped similar companies increase their efficiency by 40%. I'd love to show you how it can benefit {company} specifically.&#10;&#10;Would you be available for a 20-minute demo this week?&#10;&#10;Best regards,&#10;[Your Name]">
              <div class="flex justify-between items-start mb-2">
                <h5 class="font-medium text-gray-800 dark:text-gray-200">Smart Business Pitch</h5>
                <span class="text-xs bg-gradient-to-r from-green-500 to-yellow-500 text-white px-2 py-0.5 rounded">High Convert</span>
              </div>
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-3 line-clamp-2">Data-driven pitch template with proven conversion rates.</p>
              <button class="text-xs text-blue-500 hover:text-blue-700 dark:hover:text-blue-300 flex items-center">
                <i class="ri-trophy-line mr-1"></i> Use Smart Template
              </button>
            </div>
          </div>
          
          <div class="mt-4 flex justify-center">
            <button id="addTemplateBtn" class="gmail-btn-secondary py-2 px-4 rounded-lg flex items-center gap-2">
              <i class="ri-add-line"></i>
              Create Custom Template
            </button>
             <button id="resetTemplates" class="gmail-btn-secondary py-2 px-4 rounded-lg flex items-center gap-2 ml-2 relative" title="Reset to default templates">
  <i class="ri-refresh-line"></i>
  Reset Templates
  <span class="absolute -top-2 -right-2 text-[10px] font-bold bg-gradient-to-r from-purple-500 to-pink-500 text-transparent bg-clip-text">
    NEW
  </span>
</button>
          </div>
        </div>
        
        <!-- Smart Scheduling Section -->
        <div class="gmail-card p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-lg font-medium flex items-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent dark:from-purple-400 dark:to-pink-400 relative inline-block">
  <i class="ri-calendar-schedule-line text-purple-600 dark:text-purple-400"></i>
  Smart Auto-Schedule
  <span class="absolute -top-2 -right-8 text-[10px] font-bold bg-gradient-to-r from-yellow-400 to-orange-500 text-transparent bg-clip-text">
    NEW
  </span>
</h4>
           <div class="flex items-center gap-3">
  <label class="inline-flex items-center cursor-pointer">
    <input type="checkbox" id="scheduleToggle" class="sr-only peer">
    <div class="relative w-11 h-6 bg-gray-200 rounded-full peer peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 dark:bg-gray-700 
      after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all
      peer-checked:bg-purple-600 peer-checked:after:translate-x-full peer-checked:after:border-white dark:border-gray-600">
    </div>
    <span class="ml-3 text-sm font-medium text-gray-700 dark:text-gray-300">Enable Auto-Send</span>
  </label>
</div>
</div>
          <div id="schedulingOptions" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Start Time</label>
                <input type="time" id="scheduleTime" class="gmail-input w-full" value="09:00">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Interval (seconds)</label>
                <select id="autoInterval" class="gmail-input w-full">
                  <option value="5">5 seconds</option>
                  <option value="10" selected>10 seconds</option>
                  <option value="15">15 seconds</option>
                  <option value="30">30 seconds</option>
                  <option value="60">1 minute</option>
                  <option value="120">2 minutes</option>
                  <option value="300">5 minutes</option>
                </select>
                <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
  <i class="ri-info-line mr-1"></i>
  After auto-click, click "Continue to Gmail" once per session, then "Send" in compose.
</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Per Session</label>
                <input type="number" id="maxPerSession" class="gmail-input w-full" value="100" min="1" max="1000">
              </div>
             
            </div>
            
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
              <div class="flex items-start space-x-3">
                <i class="ri-information-line text-blue-500 mt-0.5 text-xl"></i>
                <div>
                  <p class="text-sm text-blue-700 dark:text-blue-300 font-medium mb-2">Smart Auto-Schedule Instructions:</p>
                  <ul class="text-xs text-blue-600 dark:text-blue-400 space-y-1">
                    <li><strong>✅ IMPORTANT:</strong> Allow pop-ups in your browser for automated email client opening</li>
                    <li><strong>⚡ Fast Mode:</strong> Opens each email at your set interval automatically</li>
                    <li><strong>🛡️ Smart Protection:</strong> Built-in anti-spam measures and delivery optimization</li>
                    <li><strong>📊 Live Tracking:</strong> Real-time progress with pause/resume controls</li>
                    <li><strong>🎯 Precision:</strong> Skip already sent emails and duplicates automatically</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      


      <!-- Right Column (1/4) -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Campaign Stats Card -->
        <div class="gmail-card p-6 bg-gradient-to-br from-blue-500 to-purple-600 text-white">
          <h3 class="text-lg font-medium flex items-center gap-2 mb-4">
            <i class="ri-dashboard-line"></i>
            Live Dashboard
          </h3>
          
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="bg-white/15 rounded-lg p-3 text-center backdrop-filter backdrop-blur-sm">
              <div class="text-2xl font-bold" id="sentCounter">0</div>
              <div class="text-xs opacity-80">Sent</div>
            </div>
            <div class="bg-white/15 rounded-lg p-3 text-center backdrop-filter backdrop-blur-sm">
              <div class="text-2xl font-bold" id="remainingCounter">0</div>
              <div class="text-xs opacity-80">Remaining</div>
            </div>
          </div>
          
          <div class="bg-white/15 rounded-lg p-3 text-center mb-4 backdrop-filter backdrop-blur-sm">
            <div class="text-3xl font-bold" id="totalCounter">0</div>
            <div class="text-xs opacity-80">Total Generated</div>
          </div>
          
          <!-- Live Progress Ring -->
          <div class="relative w-20 h-20 mx-auto mb-3">
            <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 36 36">
              <path class="text-white/20" stroke="currentColor" stroke-width="3" fill="none" d="m18,2.0845 a 15.9155,15.9155 0 0,1 0,31.831 a 15.9155,15.9155 0 0,1 0,-31.831"/>
              <path id="progressRing" class="text-white" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="0, 100" d="m18,2.0845 a 15.9155,15.9155 0 0,1 0,31.831 a 15.9155,15.9155 0 0,1 0,-31.831"/>
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <span id="campaignProgressText" class="text-sm font-bold">0%</span>
            </div>
          </div>
          
          <!-- Live Controls -->
          <div class="flex gap-2">
            <button id="pauseAuto" class="flex-1 bg-white/20 hover:bg-white/30 rounded-lg py-2 px-3 text-xs font-medium transition-colors hidden">
              <i class="ri-pause-line mr-1"></i> Pause
            </button>
            <button id="resumeAuto" class="flex-1 bg-white/20 hover:bg-white/30 rounded-lg py-2 px-3 text-xs font-medium transition-colors hidden">
              <i class="ri-play-line mr-1"></i> Resume
            </button>
            <button id="stopAuto" class="flex-1 bg-red-500/80 hover:bg-red-500 rounded-lg py-2 px-3 text-xs font-medium transition-colors hidden">
              <i class="ri-stop-line mr-1"></i> Stop
            </button>
          </div>
        </div>

        <!-- Smart Analytics -->
        <div class="gmail-card p-6">
          <h3 class="text-lg font-medium flex items-center gap-2 mb-4 text-gray-800 dark:text-gray-100">
            <i class="ri-brain-line text-purple-500"></i>
            Smart Analytics
          </h3>
          
          <div class="space-y-4">
            <!-- Performance Score -->
            <div class="text-center">
              <div class="relative inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-green-400 to-blue-500 mb-2">
                <span id="perfScore" class="text-white font-bold text-lg">A+</span>
              </div>
              <div class="text-xs text-gray-600 dark:text-gray-400">List Statistics</div>
            </div>
            
            
            
            <!-- Domain Distribution -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Top Domains</h4>
              <div id="domainStats" class="space-y-2">
                <div class="flex items-center justify-between text-xs">
                  <span class="text-gray-600 dark:text-gray-400">No data available</span>
                </div>
              </div>
            </div>
            
            <!-- Real-time Activity -->
            <div>
             <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 relative inline-block">
  Live Activity
  <span class="absolute -top-2 -right-6 text-[10px] font-bold bg-gradient-to-r from-indigo-500 to-blue-500 text-transparent bg-clip-text">
    NEW
  </span>
</h4>
              <div id="liveActivity" class="text-xs text-gray-500 dark:text-gray-400 h-20 overflow-y-auto bg-gray-50 dark:bg-gray-800 rounded p-2">
                <div>Ready to start campaign...</div>
              </div>
            </div>
          </div>
        </div>


<!-- Right Column (1/4) - New Progress Tracker -->
      <div class="lg:col-span-1 space-y-6 md:block">
        <!-- 24h Progress Card -->
        <div class="gmail-card p-4">
          <h4 class="text-lg font-medium flex items-center gap-2 mb-3 text-purple-500 dark:text-gray-100">
            <i class="ri-bar-chart-2-line"></i>
            24h Tracker
          </h4>
          <div class="text-center mb-4">
            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="24hSentCount">0</div>
            <p class="text-xs text-gray-500 dark:text-gray-400">emails sent in last 24h</p>
          </div>
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-3">
            <div class="bg-purple-500 h-2 rounded-full transition-all duration-300" id="24hProgressBar" style="width: 0%"></div>
          </div>
          <button id="toggleSummary" class="w-full gmail-btn-secondary py-2 px-3 text-xs flex items-center justify-center gap-1">
            <i class="ri-eye-line"></i> View Summary
          </button>
        </div>

        <!-- Hidden Summary Panel (Toggles Below) -->
        <div id="summaryPanel" class="gmail-card p-4 hidden">
          <h5 class="text-sm font-medium mb-3 flex items-center gap-2 text-green-500">Daily Performance Summary</h5>
          <ul class="space-y-2 text-xs text-gray-600 dark:text-gray-400">
            <li class="flex justify-between"><span>Total today:</span> <span id="todayTotal" class="font-medium">0</span></li>
            <li class="flex justify-between"><span>Avg/hour:</span> <span id="avgPerHour" class="font-medium">0</span></li>
            <li class="flex justify-between"><span>Est. completion:</span> <span id="estCompletion" class="font-medium">0%</span></li>
            <li class="flex justify-between"><span>Peak hour:</span> <span id="peakHour" class="font-medium">N/A</span></li>
          </ul>
          <button id="resetTracker" class="w-full mt-3 gmail-btn-secondary py-1 px-2 text-xs flex items-center justify-center gap-1 text-red-500">
            <i class="ri-refresh-line"></i> Reset Now (for testing)
          </button>
        </div>
      </div>
      
        <!-- Generated Links Section -->
        <div class="gmail-card p-6">
          <div id="mailtoLinks" class="hidden flex flex-col h-full">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-lg font-medium flex items-center gap-2 text-gray-800 dark:text-gray-100">
                <i class="ri-links-line text-blue-500"></i>
                Generated Emails
              </h3>
              
              <!-- Action Buttons Dropdown -->
              <div class="relative">
                <button id="emailActionsBtn" class="p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                  <i class="ri-more-2-fill text-gray-500 dark:text-gray-400"></i>
                </button>
                <div id="emailActionsMenu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 hidden z-10">
                  <button id="copyEmails" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center rounded-t-lg">
                    <i class="ri-file-copy-line mr-2"></i> Copy All Emails
                  </button>
                  <button id="exportAll" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center">
                    <i class="ri-download-line mr-2"></i> Export All
                  </button>
                  <button id="exportRemaining" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center">
                    <i class="ri-download-line mr-2"></i> Export Remaining
                  </button>
                  <button id="exportSelected" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center">
                    <i class="ri-download-line mr-2"></i> Export Selected
                  </button>
                  <button id="clearHistory" class="w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center rounded-b-lg">
                    <i class="ri-refresh-line mr-2"></i> Clear History
                  </button>
                </div>
              </div>
            </div>

            <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">
              Click an email to open. Orange = clicked. Ctrl+Click = multi-select. Auto-mode opens emails automatically.
            </p>

            <!-- Filter Controls -->
            <div class="flex gap-1 mb-3">
              <button id="filterAll" class="text-xs px-2 py-1 rounded bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300">All</button>
              <button id="filterSent" class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300">Sent</button>
              <button id="filterPending" class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300">Pending</button>
            </div>

            <!-- Generated Links Container -->
            <div id="generatedLinks" class="space-y-1 text-sm text-gray-800 dark:text-gray-200 email-container smooth-scroll max-h-96 overflow-y-auto"></div>
          </div>
          
          <!-- Empty State -->
          <div id="emptyState" class="flex flex-col items-center justify-center py-8 text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mb-4">
              <i class="ri-rocket-line text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200 mb-2">Ready to Launch</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
              Add recipients and generate your lightning-fast email campaign.
            </p>
            <button id="scrollToForm" class="text-sm text-blue-500 hover:text-blue-700 dark:hover:text-blue-300 flex items-center">
              <i class="ri-arrow-up-line mr-1"></i> Go to Email Form
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

   <!-- Footer Section -->
  <footer class="mt-12 py-6 border-t border-gray-200 dark:border-gray-800 text-center text-sm text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800">
    <div class="container mx-auto px-4 space-y-4">
      <p>&copy; <span id="currentYear"></span> HbeeBuzz PWA. Lightning-fast email outreach.</p>
      <p class="mt-1">Developed with ❤️ by <span class="font-medium text-blue-500">El Uthmaaniy</span></p>
      <div class="flex justify-center items-center gap-4">
        <a href="https://www.x.com/justeldev" class="text-gray-600 dark:text-gray-400 hover:text-blue-500 transition-all p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">
          <i class="ri-twitter-x-fill text-xl"></i>
        </a>
      </div>
      <button id="reset-app" class="gmail-btn-secondary py-2 px-4 mt-4 rounded-lg relative" aria-label="Reset all inputs and start over">
  <i class="ri-refresh-line mr-2"></i> Reset Campaign
  <span class="absolute -top-2 -right-2 text-[10px] font-bold bg-gradient-to-r from-teal-400 to-green-500 text-transparent bg-clip-text">
    NEW
  </span>
</button>
    </div>
  </footer>

  <!-- Floating Action Button -->
  <div id="scrollTopBtn" class="floating-btn">
    <i class="ri-arrow-up-line"></i>
  </div>

  <!-- Template Modal -->
  <div id="templateModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-md p-6 shadow-xl">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">Create Smart Template</h3>
        <button id="closeTemplateModal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
          <i class="ri-close-line text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Template Name</label>
          <input type="text" id="templateName" class="w-full gmail-input focus-effect" placeholder="e.g., Smart Follow-up">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Subject Line</label>
          <input type="text" id="templateSubject" class="w-full gmail-input focus-effect" placeholder="e.g., Quick question about {company}">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Body</label>
          <textarea id="templateBody" class="w-full gmail-input resize-none focus-effect" rows="6" placeholder="Hi {name},&#10;&#10;Your message here..."></textarea>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category</label>
          <select id="templateCategory" class="w-full gmail-input focus-effect">
            <option value="business">Business</option>
            <option value="sales">Sales</option>
            <option value="marketing">Marketing</option>
            <option value="networking">Networking</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <button id="saveTemplate" class="w-full gmail-btn py-2 px-4 rounded-lg flex items-center justify-center gap-2">
          <i class="ri-save-line"></i>
          Save Template
        </button>
      </div>
    </div>
  </div>
  
  <!-- Email Preview Modal -->
  <div id="previewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl w-full max-w-lg mx-4">
      <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Smart Email Preview</h2>
      <input id="previewEmailInput" type="email" placeholder="Enter email for preview" class="w-full p-3 border rounded-lg mb-4 gmail-input" />
      <div class="space-y-4">
        <div>
          <p class="font-medium mb-2 text-gray-700 dark:text-gray-300">Subject</p>
          <div id="previewSubject" class="p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200"></div>
        </div>
        <div>
          <p class="font-medium mb-2 text-gray-700 dark:text-gray-300">Body</p>
          <div id="previewBody" class="p-3 border rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200" style="white-space: pre-wrap; max-height: 200px; overflow-y: auto;"></div>
        </div>
      </div>
      <div class="flex gap-3 mt-6">
        <button id="updatePreview" class="gmail-btn flex-1 py-3 rounded-lg">Update Preview</button>
        <button id="closePreviewModal" class="gmail-btn-secondary flex-1 py-3 rounded-lg">Close</button>
      </div>
    </div>
  </div>

  <!-- Test Email Modal -->
  <div id="testEmailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl w-full max-w-lg mx-4">
      <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Send Test Email</h2>
      <input id="testEmailAddress" type="email" placeholder="Your test email address" class="w-full p-3 border rounded-lg mb-4 gmail-input" />
      <div class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        This will open your default email client with the personalized content for the test email address.
      </div>
      <div class="flex gap-3">
        <button id="confirmSendTest" class="gmail-btn flex-1 py-3 rounded-lg">Open Test Email</button>
        <button id="closeTestModal" class="gmail-btn-secondary flex-1 py-3 rounded-lg">Close</button>
      </div>
    </div>
  </div>
  
  
 <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  
    <script>
    // Performance-optimized JavaScript with PWA features
    document.getElementById("currentYear").textContent = new Date().getFullYear();

    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register(
            'data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30pOwpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgZXZlbnQgPT4ge30pOwpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4gew0KICBldmVudC5yZXNwb25kV2l0aChmZXRjaChldmVudC5yZXF1ZXN0KSk7DQp9KTs='
          );
          console.log('PWA: Service Worker registered successfully');
        } catch (error) {
          console.log('PWA: Service Worker registration failed:', error);
        }
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installPrompt').classList.remove('hidden');
    });

    document.getElementById('installBtn').addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          showAlert('PWA installed successfully! 🚀');
        }
        deferredPrompt = null;
        document.getElementById('installPrompt').classList.add('hidden');
      }
    });

    document.getElementById('dismissInstall').addEventListener('click', () => {
     // Pop-up Consent Prompt (one-time)
function initPopUpConsent() {
  const hasConsented = localStorage.getItem('popUpConsent') === 'true';
  if (!hasConsented) {
    const consent = confirm(
      '🚀 For auto-send to work (opens email windows), allow pop-ups for this site.\n\n' +
      'In Chrome: Click the lock icon > Site settings > Pop-ups > Allow.\n' +
      'It\'s safe—only opens your email client. Once done, auto-send will fly!\n\n' +
      'Allow now? (You won\'t see this again.)'
    );
    localStorage.setItem('popUpConsent', consent.toString());
    if (consent) {
      showAlert('✅ Pop-ups enabled! Start auto-send anytime.', 'success');
    } else {
      showAlert('⚠️ Pop-ups blocked? Auto-send may not open windows—enable in browser settings.', 'warning');
    }
  }
}

// Call on load, after PWA stuff
window.addEventListener('load', initPopUpConsent); document.getElementById('installPrompt').classList.add('hidden');
    });


    // Offline Detection
    window.addEventListener('online', () => {
      document.getElementById('offlineIndicator').classList.remove('show');
      showAlert('Back online! All features restored.', 'success');
    });

    window.addEventListener('offline', () => {
      document.getElementById('offlineIndicator').classList.add('show');
      showAlert('Working offline. Some features may be limited.', 'warning');
    });

    // Cached DOM Elements for lightning performance
    const elements = {
      recipientsInput: document.getElementById('recipients'),
      subjectInput: document.getElementById('subject'),
      bodyInput: document.getElementById('body'),
      subjectCount: document.getElementById('subjectCount'),
      bodyCount: document.getElementById('bodyCount'),
      emailForm: document.getElementById('emailForm'),
      mailtoLinks: document.getElementById('mailtoLinks'),
      emptyState: document.getElementById('emptyState'),
      globalEmailSearch: document.getElementById('globalEmailSearch'),
      scrollTopBtn: document.getElementById('scrollTopBtn'),
      emailActionsBtn: document.getElementById('emailActionsBtn'),
      emailActionsMenu: document.getElementById('emailActionsMenu'),
      scheduleToggle: document.getElementById('scheduleToggle'),
      schedulingOptions: document.getElementById('schedulingOptions'),
      scheduleTime: document.getElementById('scheduleTime'),
      autoInterval: document.getElementById('autoInterval'),
      templateModal: document.getElementById('templateModal'),
      addTemplateBtn: document.getElementById('addTemplateBtn'),
      closeTemplateModal: document.getElementById('closeTemplateModal'),
      saveTemplate: document.getElementById('saveTemplate'),
      filterAll: document.getElementById('filterAll'),
      filterSent: document.getElementById('filterSent'),
      filterPending: document.getElementById('filterPending'),
      templatesContainer: document.getElementById('templatesContainer'),
      globalProgressBar: document.getElementById('globalProgressBar'),
      globalProgressInner: document.querySelector('#globalProgressBar .progress-bar'),
      previewEmail: document.getElementById('previewEmail'),
      previewModal: document.getElementById('previewModal'),
      closePreviewModal: document.getElementById('closePreviewModal'),
      previewEmailInput: document.getElementById('previewEmailInput'),
      previewSubject: document.getElementById('previewSubject'),
      previewBody: document.getElementById('previewBody'),
      updatePreview: document.getElementById('updatePreview'),
      sendTestEmail: document.getElementById('sendTestEmail'),
      testEmailModal: document.getElementById('testEmailModal'),
      closeTestModal: document.getElementById('closeTestModal'),
      testEmailAddress: document.getElementById('testEmailAddress'),
      confirmSendTest: document.getElementById('confirmSendTest'),
      pauseAuto: document.getElementById('pauseAuto'),
      resumeAuto: document.getElementById('resumeAuto'),
      stopAuto: document.getElementById('stopAuto'),
      quickActions: document.getElementById('quickActions'),
      toggleQuickActions: document.getElementById('toggleQuickActions'),
      quickActionsIcon: document.getElementById('quickActionsIcon')
    };

    // Lightning-fast data storage
    let emailData = {
      recipients: localStorage.getItem('recipients') || '',
      subject: localStorage.getItem('subject') || '',
      body: localStorage.getItem('body') || ''
    };

    // Set initial values
    elements.recipientsInput.value = emailData.recipients;
    elements.subjectInput.value = emailData.subject;
    elements.bodyInput.value = emailData.body;

    // Global variables with performance optimization
    let allTimeSent = new Set(JSON.parse(localStorage.getItem('allTimeSent') || '[]'));
    let domainStats = {};
    let allGeneratedEmails = [];
    let recentSends = [];
    let isAutoScheduled = false;
    let autoSendInterval = null;
    let currentEmailIndex = 0;
    let isPaused = false;
    let currentFilter = 'all';
    let selectedEmails = new Set();
    let lastClearedHistory = null;
    let performanceMetrics = {
      startTime: null,
      emailsSent: 0,
      averageSpeed: 0
    };

    // Helper functions
    function extractNameFromEmail(email) {
      if (!email || !email.includes('@')) return 'there';
      
      const commonFirstNames = [
        'john', 'jane', 'david', 'mary', 'james', 'linda', 'robert', 'michael', 'sarah', 'william', 
        'patricia', 'joseph', 'jennifer', 'thomas', 'elizabeth', 'charles', 'susan', 'daniel', 'margaret',
        'matthew', 'emma', 'anthony', 'olivia', 'mark', 'emily', 'paul', 'sophia', 'steven', 'ava', 
        'andrew', 'isabella', 'joshua', 'mia', 'kenneth', 'charlotte', 'kevin', 'amelia', 'brian', 'harper',
        'george', 'evelyn', 'timothy', 'anna', 'ronald', 'hannah', 'jason', 'leah', 'edward', 'scarlett',
        'jeffrey', 'grace', 'ryan', 'lily', 'jacob', 'madison', 'gary', 'layla', 'nicholas', 'zoey',
        'eric', 'camila', 'adam', 'abigail', 'amanda', 'riley', 'jonathan', 'zoe', 'justin', 'chloe',
        'scott', 'penelope', 'brandon', 'hazel', 'frank', 'violet', 'benjamin', 'victoria', 'gregory',
        'peter', 'jack', 'nathan', 'ali', 'stephen', 'dennis', 'joshua', 'tyler', 'aaron', 'henry',
        'douglas', 'jose', 'peter', 'adam', 'zachary', 'walter', 'jerry', 'patrick', 'noah', 'amy',
        'michelle', 'kimberly', 'deborah', 'judy', 'lisa', 'sandra', 'ashley', 'donna', 'carol',
        'jessica', 'nancy', 'karen', 'betty', 'helen', 'dorothy', 'sharon', 'ruth', 'angela', 'melissa',
        'diane', 'alice', 'marie', 'ann', 'catherine', 'laura', 'rebecca', 'joyce', 'rachel', 'tina',
        'sara', 'andrea', 'nicole', 'janet', 'julia', 'sophia', 'ethan', 'mason', 'liam', 'oliver',
        'elijah', 'logan', 'lucas', 'carter', 'isaac', 'gabriel', 'owen', 'chike', 'ayo', 'tunde',
        'amina', 'fatima', 'kemi', 'tosin', 'adebola', 'chijioke', 'ugochi', 'khalid', 'agatha', 'lola',
        'emma', 'janelle', 'mahatma', 'nucture', 'peace'
      ];
      
      const nonPersonalPrefixes = [
        'info', 'infos', 'contact', 'contacts', 'support', 'mail', 'hello', 'help', 'enquiries', 
        'enquiry', 'inquiry', 'inquiries', 'store', 'sales', 'kontact', 'hi', 'official', 'service', 
        'contacto', 'admin', 'hey', 'orders', 'customercare', 'customer', 'returns', 'shop', 'delivery', 
        'kontakt', 'www', 'team', 'business', 'customers', 'chat', 'marketing', 'noreply', 'no-reply',
        'newsletter', 'billing', 'account', 'careers', 'webmaster', 'media', 'press', 'hr', 'jobs',
        'helpdesk', 'feedback', 'care', 'office', 'reception', 'assist', 'concierge', 'desk', 'general',
        'postmaster', 'automation', 'autoresponder', 'donotreply', 'no_reply', 'notifications', 'alerts',
        'system', 'mailer', 'subscription', 'subscribe', 'unsubscribe', 'payments', 'invoice', 'order',
        'shipping', 'dispatch', 'reservations', 'bookings', 'membership', 'services', 'automated', 'bot',
        'do-not-reply', 'do_not_reply', 'donot_reply', 'donot-reply', 'noreply', 'webinfo', 'infomail', 'suporte', 'soporte', 'contato', 'hola', 'boutique', 'bonjour', 'suport', 'regard', 'studios'
      ];
          
      let emailParts = email.split('@');
      let namePart = emailParts[0];
      const domainPart = emailParts[1] ? emailParts[1].split('.')[0] : '';
      
      if (nonPersonalPrefixes.includes(namePart.toLowerCase())) {
        return domainPart.charAt(0).toUpperCase() + domainPart.slice(1);
      }
      
      // Check for common patterns
      let nameParts = [];
      if (namePart.includes('.')) {
        nameParts = namePart.split('.');
      } else if (namePart.includes('_')) {
        nameParts = namePart.split('_');
      } else if (namePart.includes('-')) {
        nameParts = namePart.split('-');
      } else {
        // Check for common first names at the start
        for (const firstName of commonFirstNames) {
          if (namePart.toLowerCase().startsWith(firstName) && 
              firstName !== namePart.toLowerCase() && 
              firstName.length >= 3) {
            return firstName.charAt(0).toUpperCase() + firstName.slice(1);
          }
        }
        nameParts = [namePart];
      }
      
      // Clean and format name parts
      if (nameParts.length > 0 && !nonPersonalPrefixes.includes(nameParts[0].toLowerCase())) {
        const cleanPart = nameParts[0].replace(/\d+$/, '');
        return cleanPart.charAt(0).toUpperCase() + cleanPart.slice(1);
      }
      
      return domainPart.charAt(0).toUpperCase() + domainPart.slice(1) || 'there';
    }

    function extractCompanyFromEmail(email) {
      const domain = email.split('@')[1] ? email.split('@')[1].split('.')[0] : 'Company';
      return domain.charAt(0).toUpperCase() + domain.slice(1);
    }

    function personalizeContent(template, name, company) {
      return template.replace(/{name}/g, name).replace(/{company}/g, company);
    }

    // Ultra-fast email validation
    function isValidEmail(email) {
      const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      return emailRegex.test(email);
    }

    // Lightning-fast character count
    function updateCharacterCount() {
      const subjectLength = elements.subjectInput.value.length;
      const bodyLength = elements.bodyInput.value.length;

      elements.subjectCount.innerText = `${subjectLength}/200`;
      elements.bodyCount.innerText = `${bodyLength}/2000`;

      if (subjectLength > 200) elements.subjectInput.value = elements.subjectInput.value.slice(0, 200);
      if (bodyLength > 2000) elements.bodyInput.value = elements.bodyInput.value.slice(0, 2000);
    }

    elements.subjectInput.addEventListener('input', updateCharacterCount);
    elements.bodyInput.addEventListener('input', updateCharacterCount);
    updateCharacterCount();

    // Smart email validation with advanced features
    let validationTimeout;
    elements.recipientsInput.addEventListener('input', function () {
      clearTimeout(validationTimeout);
      validationTimeout = setTimeout(() => {
        const emails = this.value.split('\n');
        let validEmailsCount = 0;
        let invalidEmailsCount = 0;
        const uniqueEmails = new Set();
        let duplicateCount = 0;

        emails.forEach(email => {
          email = email.trim();
          if (email) {
            if (uniqueEmails.has(email.toLowerCase())) {
              duplicateCount++;
            } else {
              uniqueEmails.add(email.toLowerCase());
              if (isValidEmail(email)) {
                validEmailsCount++;
              } else {
                invalidEmailsCount++;
              }
            }
          }
        });

        document.getElementById('invalidEmails').innerText = invalidEmailsCount;
        document.getElementById('validEmails').innerText = validEmailsCount;
        document.getElementById('totalEmails').innerText = emails.filter(email => email.trim()).length;
        document.getElementById('duplicateEmails').innerText = duplicateCount;
        
        const validIndicator = document.getElementById('validEmailsIndicator');
        const invalidIndicator = document.getElementById('invalidEmailsIndicator');
        
        validIndicator.classList.toggle('hidden', validEmailsCount === 0);
        invalidIndicator.classList.toggle('hidden', invalidEmailsCount === 0);
        
        // Update domain stats preview
        updateDomainStats();
      }, 200);
    });

    // Auto-save with performance optimization
    let saveTimeout;
    function autoSave() {
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        localStorage.setItem('recipients', elements.recipientsInput.value);
        localStorage.setItem('subject', elements.subjectInput.value);
        localStorage.setItem('body', elements.bodyInput.value);
      }, 3000);
    }

    elements.recipientsInput.addEventListener('input', autoSave);
    elements.subjectInput.addEventListener('input', autoSave);
    elements.bodyInput.addEventListener('input', autoSave);

    // Smart template functionality
    document.addEventListener('click', function(e) {
      if (e.target.closest('.template-chip')) {
        const chip = e.target.closest('.template-chip');
        const target = chip.dataset.target;
        const template = chip.dataset.template;
        
        if (target === 'subject') {
          elements.subjectInput.value = template;
        } else if (target === 'body') {
          elements.bodyInput.value = template.replace(/&#10;/g, '\n');
        }
        updateCharacterCount();
        showAlert('Template applied successfully!');
      }
      
      if (e.target.closest('[data-template-subject]')) {
        const template = e.target.closest('[data-template-subject]');
        const subject = template.dataset.templateSubject;
        const body = template.dataset.templateBody.replace(/&#10;/g, '\n');
        
        elements.subjectInput.value = subject;
        elements.bodyInput.value = body;
        updateCharacterCount();
        
        showAlert('AI-enhanced template applied!');
      }
    });

    // Smart scheduling functionality
    elements.scheduleToggle.addEventListener('change', function() {
      if (this.checked) {
        elements.schedulingOptions.classList.remove('hidden');
        showAlert('Smart auto-schedule enabled! Remember to allow pop-ups.', 'success');
      } else {
        elements.schedulingOptions.classList.add('hidden');
        stopAutoSend();
      }
    });

    // Advanced options toggle
    document.getElementById('toggleAdvanced').addEventListener('click', function() {
      const options = document.getElementById('advancedOptions');
      const icon = document.getElementById('advancedIcon');
      
      if (options.classList.contains('hidden')) {
        options.classList.remove('hidden');
        icon.classList.replace('ri-arrow-down-s-line', 'ri-arrow-up-s-line');
      } else {
        options.classList.add('hidden');
        icon.classList.replace('ri-arrow-up-s-line', 'ri-arrow-down-s-line');
      }
    });

    // Smart filter functionality
    function setActiveFilter(filter) {
      currentFilter = filter;
      
      [elements.filterAll, elements.filterSent, elements.filterPending].forEach(btn => {
        btn.classList.remove('bg-blue-100', 'text-blue-700', 'dark:bg-blue-900/30', 'dark:text-blue-300');
        btn.classList.add('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
      });
      
      const activeBtn = filter === 'all' ? elements.filterAll : filter === 'sent' ? elements.filterSent : elements.filterPending;
      activeBtn.classList.remove('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
      activeBtn.classList.add('bg-blue-100', 'text-blue-700', 'dark:bg-blue-900/30', 'dark:text-blue-300');
      
      applyEmailFilter();
    }

    elements.filterAll.addEventListener('click', () => setActiveFilter('all'));
    elements.filterSent.addEventListener('click', () => setActiveFilter('sent'));
    elements.filterPending.addEventListener('click', () => setActiveFilter('pending'));

    function applyEmailFilter() {
      const emailLinks = document.querySelectorAll('#generatedLinks a');
      
      emailLinks.forEach(link => {
        const email = link.textContent.split('. ')[1];
        const isSent = allTimeSent.has(email);
        
        let shouldShow = true;
        if (currentFilter === 'sent' && !isSent) shouldShow = false;
        if (currentFilter === 'pending' && isSent) shouldShow = false;
        
        link.style.display = shouldShow ? 'block' : 'none';
      });
    }

    // Lightning-fast form submission
    elements.emailForm.addEventListener('submit', function (event) {
      event.preventDefault();

      const recipients = elements.recipientsInput.value.split('\n').filter(r => r.trim());
      const subjectTemplate = elements.subjectInput.value;
      const bodyTemplate = elements.bodyInput.value;
      
      if (recipients.length === 0) {
        showAlert('Please add at least one recipient email.', 'error');
        return;
      }
      
      if (elements.scheduleToggle.checked) {
        startAutoSend(recipients, subjectTemplate, bodyTemplate);
      } else {
        processEmails(recipients, subjectTemplate, bodyTemplate);
      }
    });

    // Auto-send functionality with smart intervals
    function startAutoSend(recipients, subjectTemplate, bodyTemplate) {
      const interval = parseInt(elements.autoInterval.value) * 1000;
      const maxPerSession = parseInt(document.getElementById('maxPerSession').value);
      
      processEmails(recipients, subjectTemplate, bodyTemplate);
      
      isAutoScheduled = true;
      currentEmailIndex = 0;
      performanceMetrics.startTime = Date.now();
      
      // Show control buttons
      elements.pauseAuto.classList.remove('hidden');
      elements.stopAuto.classList.remove('hidden');
      
      showAlert(`🚀 Auto-send started! Opening emails every ${interval/1000}s. Make sure pop-ups are allowed!`, 'success');
      
      autoSendInterval = setInterval(() => {
        if (isPaused) return;
        
        const emailLinks = document.querySelectorAll('#generatedLinks a:not([style*="display: none"])');
        const unsentLinks = Array.from(emailLinks).filter(link => {
          const email = link.textContent.split('. ')[1];
          return !allTimeSent.has(email);
        });
        
        if (unsentLinks.length === 0 || currentEmailIndex >= maxPerSession) {
          stopAutoSend();
          showAlert('🎉 Auto-send completed! All emails processed.', 'success');
          if (currentEmailIndex >= maxPerSession) {
            showAlert(`Session limit reached (${maxPerSession} emails). You can restart for more.`, 'warning');
          }
          return;
        }
        
        const currentLink = unsentLinks[0];
        if (currentLink) {
          currentLink.click();
          currentEmailIndex++;
          
        
          
          // Update live activity
          addLiveActivity(`📧 Auto-sent to ${currentLink.textContent.split('. ')[1]}`);
        }
      }, interval);
    }

    function pauseAutoSend() {
      isPaused = true;
      elements.pauseAuto.classList.add('hidden');
      elements.resumeAuto.classList.remove('hidden');
      showAlert('⏸️ Auto-send paused', 'warning');
      addLiveActivity('⏸️ Auto-send paused by user');
    }

    function resumeAutoSend() {
      isPaused = false;
      elements.pauseAuto.classList.remove('hidden');
      elements.resumeAuto.classList.add('hidden');
      showAlert('▶️ Auto-send resumed', 'success');
      addLiveActivity('▶️ Auto-send resumed');
    }

    function stopAutoSend() {
      if (autoSendInterval) {
        clearInterval(autoSendInterval);
        autoSendInterval = null;
      }
      isAutoScheduled = false;
      isPaused = false;
      currentEmailIndex = 0;
      
      elements.pauseAuto.classList.add('hidden');
      elements.resumeAuto.classList.add('hidden');
      elements.stopAuto.classList.add('hidden');
      
      addLiveActivity('🛑 Auto-send stopped');
    }

    elements.pauseAuto.addEventListener('click', pauseAutoSend);
    elements.resumeAuto.addEventListener('click', resumeAutoSend);
    elements.stopAuto.addEventListener('click', stopAutoSend);

    // Lightning-fast email processing
    function processEmails(recipientList, subjectTemplate, bodyTemplate) {
      const submitBtn = elements.emailForm.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="ri-loader-4-line animate-spin"></i> Processing...';
      submitBtn.disabled = true;
      
      startProgress('Processing emails');
      
      const mailtoLinksDiv = document.getElementById('generatedLinks');
      mailtoLinksDiv.innerHTML = '';
      allGeneratedEmails = [];
      
      elements.mailtoLinks.classList.remove('hidden');
      elements.emptyState.classList.add('hidden');
      
      const batchSize = parseInt(document.getElementById('batchSize').value) || 50;
      const totalEmails = recipientList.filter(r => r.trim()).length;
      let processedCount = 0;

      updateCounters();

      // Optimized worker code with faster name extraction
      const workerCode = `
        function extractNameFromEmail(email) {
          if (!email || !email.includes('@')) return 'there';
          
          const commonFirstNames = [
            'john', 'jane', 'david', 'mary', 'james', 'linda', 'robert', 'michael', 'sarah', 'william', 
            'patricia', 'joseph', 'jennifer', 'thomas', 'elizabeth', 'charles', 'susan', 'daniel', 'margaret',
            'matthew', 'emma', 'anthony', 'olivia', 'mark', 'emily', 'paul', 'sophia', 'steven', 'ava', 
            'andrew', 'isabella', 'joshua', 'mia', 'kenneth', 'charlotte', 'kevin', 'amelia', 'brian', 'harper',
            'george', 'evelyn', 'timothy', 'anna', 'ronald', 'hannah', 'jason', 'leah', 'edward', 'scarlett',
            'jeffrey', 'grace', 'ryan', 'lily', 'jacob', 'madison', 'gary', 'layla', 'nicholas', 'zoey',
            'eric', 'camila', 'adam', 'abigail', 'amanda', 'riley', 'jonathan', 'zoe', 'justin', 'chloe',
            'scott', 'penelope', 'brandon', 'hazel', 'frank', 'violet', 'benjamin', 'victoria', 'gregory',
            'peter', 'jack', 'nathan', 'ali', 'stephen', 'dennis', 'joshua', 'tyler', 'aaron', 'henry',
            'douglas', 'jose', 'peter', 'adam', 'zachary', 'walter', 'jerry', 'patrick', 'noah', 'amy',
            'michelle', 'kimberly', 'deborah', 'judy', 'lisa', 'sandra', 'ashley', 'donna', 'carol',
            'jessica', 'nancy', 'karen', 'betty', 'helen', 'dorothy', 'sharon', 'ruth', 'angela', 'melissa',
            'diane', 'alice', 'marie', 'ann', 'catherine', 'laura', 'rebecca', 'joyce', 'rachel', 'tina',
            'sara', 'andrea', 'nicole', 'janet', 'julia', 'sophia', 'ethan', 'mason', 'liam', 'oliver',
            'elijah', 'logan', 'lucas', 'carter', 'isaac', 'gabriel', 'owen', 'chike', 'ayo', 'tunde',
            'amina', 'fatima', 'kemi', 'tosin', 'adebola', 'chijioke', 'ugochi', 'khalid', 'agatha', 'lola',
            'emma', 'janelle', 'mahatma', 'nucture', 'peace'
          ];
          
          const nonPersonalPrefixes = [
            'info', 'infos', 'contact', 'contacts', 'support', 'mail', 'hello', 'help', 'enquiries', 
            'enquiry', 'inquiry', 'inquiries', 'store', 'sales', 'kontact', 'hi', 'official', 'service', 
            'contacto', 'admin', 'hey', 'orders', 'customercare', 'customer', 'returns', 'shop', 'delivery', 
            'kontakt', 'www', 'team', 'business', 'customers', 'chat', 'marketing', 'noreply', 'no-reply',
            'newsletter', 'billing', 'account', 'careers', 'webmaster', 'media', 'press', 'hr', 'jobs',
            'helpdesk', 'feedback', 'care', 'office', 'reception', 'assist', 'concierge', 'desk', 'general',
            'postmaster', 'automation', 'autoresponder', 'donotreply', 'no_reply', 'notifications', 'alerts',
            'system', 'mailer', 'subscription', 'subscribe', 'unsubscribe', 'payments', 'invoice', 'order',
            'shipping', 'dispatch', 'reservations', 'bookings', 'membership', 'services', 'automated', 'bot',
            'do-not-reply', 'do_not_reply', 'donot_reply', 'donot-reply', 'noreply', 'webinfo', 'infomail', 'suporte', 'soporte', 'contato', 'hola', 'boutique', 'bonjour', 'suport', 'regard', 'studios', 'information'
          ];
          
          const specialDomainTerms = ['store', 'team', 'elegance', 'shop', 'beauty', 'tech', 'studio', 'lab', 'labs'];
          
          let emailParts = email.split('@');
          let namePart = emailParts[0];
          const domainPart = emailParts[1] ? emailParts[1].split('.')[0] : '';
          
            // NEW RULE: Strip leading numbers (and optional dots) before letters
  // Example: "012luxora" -> "luxora", "1.13candleco" -> "candleco"
  namePart = namePart.replace(/^[0-9.]+(?=[a-zA-Z])/, '');
  
          
          if (domainPart && nonPersonalPrefixes.includes(namePart.toLowerCase())) {
            return domainPart.charAt(0).toUpperCase() + domainPart.slice(1);
          }
          
          if (!namePart.includes('.') && !namePart.includes('_') && !namePart.includes('-')) {
            for (const prefix of nonPersonalPrefixes) {
              if (namePart.toLowerCase().startsWith(prefix)) {
                namePart = namePart.slice(prefix.length);
                break;
              }
            }
            
            for (const firstName of commonFirstNames) {
              if (namePart.toLowerCase().startsWith(firstName) && 
                  firstName !== namePart.toLowerCase() && 
                  firstName.length >= 3) {
                return firstName.charAt(0).toUpperCase() + firstName.slice(1);
              }
            }
          }
          
          let nameParts = [];
          if (namePart.includes('.')) {
            nameParts = namePart.split('.');
          } else if (namePart.includes('_')) {
            nameParts = namePart.split('_');
          } else if (namePart.includes('-')) {
            nameParts = namePart.split('-');
          } else {
            nameParts = [namePart];
          }
          
          if (nameParts.length > 0 && nonPersonalPrefixes.includes(nameParts[0].toLowerCase())) {
            nameParts.shift();
          }
          
          if (nameParts.length > 1 && 
              nameParts[0].length < 4 && 
              !['hi', 'hey', 'www'].includes(nameParts[0].toLowerCase())) {
            // Keep both parts
          } else if (nameParts.length > 1) {
            nameParts = [nameParts[0]];
          }
          
          if (nameParts.length === 0 || nonPersonalPrefixes.includes(nameParts[0].toLowerCase())) {
            const capitalizedDomain = domainPart.charAt(0).toUpperCase() + domainPart.slice(1);
            return capitalizedDomain;
          }
          
          let formattedName = '';
          if (nameParts.length > 1 && specialDomainTerms.includes(nameParts[1].toLowerCase())) {
            formattedName = nameParts.map(part => {
              const cleanPart = part.replace(/\\d+$/, '');
              return cleanPart.charAt(0).toUpperCase() + cleanPart.slice(1);
            }).join(' ');
          } else {
            formattedName = nameParts.map(part => {
              const cleanPart = part.replace(/\\d+$/, '');
              return cleanPart.charAt(0).toUpperCase() + cleanPart.slice(1);
            }).join(' ');
          }
          
          return formattedName || domainPart.charAt(0).toUpperCase() + domainPart.slice(1) || 'there';
        }
        
        function extractCompanyFromEmail(email) {
          const domain = email.split('@')[1] ? email.split('@')[1].split('.')[0] : 'Company';
          return domain.charAt(0).toUpperCase() + domain.slice(1);
        }

        function personalizeContent(template, name, company) {
          return template.replace(/{name}/g, name).replace(/{company}/g, company);
        }

        self.onmessage = function(e) {
          const { emails, subjectTemplate, bodyTemplate, startIndex } = e.data;
          
          const results = emails.map((email, idx) => {
            const trimmedEmail = email.trim();
            if (!trimmedEmail || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(trimmedEmail)) return null;
            
            const name = extractNameFromEmail(trimmedEmail);
            const company = extractCompanyFromEmail(trimmedEmail);
            const personalizedSubject = encodeURIComponent(personalizeContent(subjectTemplate, name, company));
            const personalizedBody = encodeURIComponent(personalizeContent(bodyTemplate, name, company)).replace(/\\n/g, '%0D%0A');
            return {
              email: trimmedEmail,
              mailto: \`mailto:\${trimmedEmail}?subject=\${personalizedSubject}&body=\${personalizedBody}\`,
              index: startIndex + idx
            };
          }).filter(item => item !== null);
          
          self.postMessage(results);
        }
      `;
      
      const worker = new Worker(URL.createObjectURL(new Blob([workerCode], {type: 'text/javascript'})));
      
      let currentBatch = 0;
      
      function processBatch() {
        const start = currentBatch * batchSize;
        const end = Math.min(start + batchSize, recipientList.length);
        const batch = recipientList.slice(start, end);
        
        if (batch.length === 0) {
          finishProcessing();
          return;
        }
        
        worker.postMessage({
          emails: batch,
          subjectTemplate,
          bodyTemplate,
          startIndex: start
        });
        
        currentBatch++;
      }
      
      worker.onmessage = function(e) {
        const results = e.data;
        
        const fragment = document.createDocumentFragment();
        
        results.forEach(result => {
          const linkElement = document.createElement('a');
          linkElement.href = result.mailto;
          linkElement.className = 'email-link text-green-500 block transition-colors';
          linkElement.innerText = `${result.index + 1}. ${result.email}`;
          linkElement.target = "_blank";
          
          if (allTimeSent.has(result.email)) {
            linkElement.style.color = 'orange';
          }
          
          linkElement.addEventListener('click', function (event) {
    if (event.ctrlKey || event.metaKey) {
        event.preventDefault();
        linkElement.classList.toggle('selected');
        if (linkElement.classList.contains('selected')) {
            selectedEmails.add(result.email);
        } else {
            selectedEmails.delete(result.email);
        }
        return;
    }
    
    event.preventDefault();
    
    if (allTimeSent.has(result.email)) {
    showAlert(`📧 Email "${result.email}" already sent!`, 'warning');
} else {
    linkElement.style.color = 'orange';
    
    allTimeSent.add(result.email);  // Add to all-time
    recentSends.push({email: result.email, timestamp: Date.now()});  // New: Add to 24h tracker
    
    // Persist both
    localStorage.setItem('allTimeSent', JSON.stringify([...allTimeSent]));
    localStorage.setItem('recentSends', JSON.stringify(recentSends));
    
    // Open with pop-up detection
const openedWindow = window.open(result.mailto, '_blank');
if (!openedWindow || openedWindow.closed || typeof openedWindow.closed === 'undefined') {
  // Blocked—re-prompt if not recent
  const lastPrompt = localStorage.getItem('lastBlockedPrompt') || 0;
  if (Date.now() - parseInt(lastPrompt) > 60000) {  // 1 min cooldown
    showAlert(
      '🔒 Pop-up blocked! Enable pop-ups for this site to auto-open emails.\n\n' +
      'Tip: After allowing, you\'ll still see "Continue to Gmail" once—click it to reach compose.',
      'warning'
    );
    localStorage.setItem('lastBlockedPrompt', Date.now().toString());
  }
} else {
  // Success—focus the window
  openedWindow.focus();
}
    
    requestAnimationFrame(() => {
        updateCounters();  // Existing all-time update
        updateAnalytics();  // Existing
        update24hDisplay();  // New: Update 24h display
    });
    
    addLiveActivity(`📧 Opened email for ${result.email}`);
    
    if (allTimeSent.size % 50 === 0) {  // Updated to allTimeSent.size
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
        });
        showAlert(`🚀 Milestone! ${allTimeSent.size} emails sent!`);
    }
}
    
    applyEmailFilter();
});
          fragment.appendChild(linkElement);
          allGeneratedEmails.push(result);
        });
        
        mailtoLinksDiv.appendChild(fragment);
        
        // Update domain stats
        results.forEach(result => {
          const domain = result.email.split('@')[1];
          domainStats[domain] = (domainStats[domain] || 0) + 1;
        });
        
        processedCount += results.length;
        const progressPercent = Math.min((processedCount / totalEmails) * 100, 100);
        updateProgress(progressPercent);
        
        if (currentBatch * batchSize < recipientList.length) {
          requestAnimationFrame(processBatch);
        } else {
          finishProcessing();
        }
      };
      
      function finishProcessing() {
    worker.terminate();
    
    submitBtn.innerHTML = originalBtnText;
    submitBtn.disabled = false;
    
    endProgress();
    
    requestAnimationFrame(() => {
        updateCounters();
        updateAnalytics();
        updateDomainStats();
    });
    
    showAlert(`🚀 ${processedCount} lightning emails generated!`);
    // Auto-scroll to generated emails
const generatedSection = document.getElementById('mailtoLinks');
if (generatedSection) {
  generatedSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
    addLiveActivity(`✅ Generated ${processedCount} email links`);
}

processBatch();
    }

// Smart counter updates
function updateCounters() {
  const total = allGeneratedEmails.length;
  const sent = allTimeSent.size;
  const remaining = total - sent;
  
  requestAnimationFrame(() => {
    document.getElementById('totalCounter').textContent = total;
    document.getElementById('sentCounter').textContent = sent;
    document.getElementById('remainingCounter').textContent = remaining;
    document.getElementById('headerSentCount').textContent = sent;
       update24hDisplay();  document.getElementById('headerRemainingCount').textContent = remaining;
    
    const progress = total > 0 ? (sent / total) * 100 : 0;
    const progressRing = document.getElementById('progressRing');
    const circumference = 2 * Math.PI * 15.9155;
    const strokeDasharray = `${(progress / 100) * circumference} ${circumference}`;
    progressRing.style.strokeDasharray = strokeDasharray;    
    document.getElementById('campaignProgressText').textContent = `${Math.round(progress)}%`;
        
   
  });
}


// New: Get 24h count (unique emails first-sent in last 24h)
function get24hCount() {
  const now = Date.now();
  const twentyFourHoursAgo = now - 86400000;  // 24h in ms
  return recentSends.filter(item => item.timestamp > twentyFourHoursAgo).length;
}

// New: Get today-only count (midnight to now, for summary)
function getTodayCount() {
  const now = new Date();
  const todayMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
  return recentSends.filter(item => item.timestamp >= todayMidnight).length;
}


// New: Update 24h display (real-time)
function update24hDisplay() {
  const count = get24hCount();
  const todayCount = getTodayCount();
  const totalRecent = recentSends.length;  // All recent (but filtered on load)
  const progress = totalRecent > 0 ? Math.min((count / totalRecent) * 100, 100) : 0;
  const hoursElapsed = 24;  // Fixed for 24h window
  const avgPerHour = todayCount > 0 ? Math.round(todayCount / (new Date().getHours() + 1)) : 0;
  const estCompletion = Math.min((count / 500) * 100, 100);  // Assume 500/day goal; customize

  // Compute peak hour properly
  let peakHour = 'N/A';
  if (recentSends.length > 0) {
    const hourCount = {};
    recentSends.forEach(item => {
      const hour = new Date(item.timestamp).getHours();
      hourCount[hour] = (hourCount[hour] || 0) + 1;
    });
    peakHour = Object.entries(hourCount).reduce((max, [hour, cnt]) => cnt > max[1] ? [hour, cnt] : max, [0, 0])[0];
  }

  // Update DOM
  document.getElementById('24hSentCount').textContent = count;
  document.getElementById('24hProgressBar').style.width = `${progress}%`;
  document.getElementById('todayTotal').textContent = todayCount;
  document.getElementById('avgPerHour').textContent = avgPerHour;
  document.getElementById('estCompletion').textContent = `${Math.round(estCompletion)}%`;
  document.getElementById('peakHour').textContent = peakHour;
}


// New: Toggle summary panel
document.getElementById('toggleSummary').addEventListener('click', function() {
  const panel = document.getElementById('summaryPanel');
  panel.classList.toggle('hidden');
  panel.classList.toggle('show');
  this.innerHTML = panel.classList.contains('show') ? 
    '<i class="ri-eye-off-line"></i> Hide Summary' : 
    '<i class="ri-eye-line"></i> View Summary';
});

// New: Manual reset for testing (auto-resets on load anyway)
document.getElementById('resetTracker').addEventListener('click', function() {
  if (confirm('Reset 24h tracker? (For testing only)')) {
    recentSends = [];
    localStorage.setItem('recentSends', '[]');
    update24hDisplay();
    showAlert('24h tracker reset!', 'warning');
  }
});



// Smart analytics
function updateAnalytics() {
  const total = allGeneratedEmails.length;
  const sent = allTimeSent.size;
  
  if (total > 0) {
    const sentPercent = (sent / total) * 100;
    const grade = sentPercent >= 80 ? 'A+' : sentPercent >= 60 ? 'A' : sentPercent >= 40 ? 'B+' : sentPercent >= 20 ? 'B' : 'C';
    document.getElementById('perfScore').textContent = grade;
  }
}

// Smart domain stats
function updateDomainStats() {
  const domainStatsContainer = document.getElementById('domainStats');
  
  const sortedDomains = Object.entries(domainStats)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 5);
  
  if (sortedDomains.length === 0) {
    domainStatsContainer.innerHTML = '<div class="flex items-center justify-between text-xs"><span class="text-gray-600 dark:text-gray-400">No data available</span></div>';
    return;
  }
  
  const fragment = document.createDocumentFragment();
  sortedDomains.forEach(([domain, count]) => {
    const domainElement = document.createElement('div');
    domainElement.className = 'flex items-center justify-between text-xs';
    domainElement.innerHTML = `
      <span class="text-gray-700 dark:text-gray-300">${domain}</span>
      <span class="font-medium text-blue-500">${count}</span>
    `;
    fragment.appendChild(domainElement);
  });
  
  domainStatsContainer.innerHTML = '';
  domainStatsContainer.appendChild(fragment);
}

// Live activity feed
function addLiveActivity(message) {
  const activityFeed = document.getElementById('liveActivity');
  const timestamp = new Date().toLocaleTimeString();
  const activity = document.createElement('div');
  activity.className = 'text-xs text-gray-600 dark:text-gray-400 animate-fadeIn';
  activity.textContent = `[${timestamp}] ${message}`;
  
  activityFeed.insertBefore(activity, activityFeed.firstChild);
  
  // Keep only last 10 activities
  while (activityFeed.children.length > 10) {
    activityFeed.removeChild(activityFeed.lastChild);
  }
  
  activityFeed.scrollTop = 0;
}

// Global search with AI commands
const performGlobalSearch = debounce(function (query) {
  const lowerQuery = query.toLowerCase();
  
  // Handle AI commands
  if (lowerQuery.startsWith('find:')) {
    const domain = lowerQuery.replace('find:', '').trim();
    filterByDomain(domain);
    return;
  }
  
  if (lowerQuery.startsWith('sort:')) {
    const sortType = lowerQuery.replace('sort:', '').trim();
    sortEmails(sortType);
    return;
  }
  
  if (lowerQuery.startsWith('filter:')) {
    const filterType = lowerQuery.replace('filter:', '').trim();
    if (filterType === 'unsent') setActiveFilter('pending');
    else if (filterType === 'sent') setActiveFilter('sent');
    return;
  }
  
  // Regular search
  const emailLinks = document.querySelectorAll('#generatedLinks a');
  let foundAny = false;

  emailLinks.forEach(link => {
    const text = link.innerText.toLowerCase();
    const match = text.includes(lowerQuery);
    foundAny = foundAny || match;
    
    const email = link.textContent.split('. ')[1];
    const isSent = allTimeSent.has(email);
    
    let shouldShow = match;
    if (currentFilter === 'sent' && !isSent) shouldShow = false;
    if (currentFilter === 'pending' && isSent) shouldShow = false;
    
    link.style.display = shouldShow ? 'block' : 'none';
    link.style.backgroundColor = match && lowerQuery ? 'rgba(74, 222, 128, 0.1)' : '';
  });
}, 150);

function debounce(func, delay) {
  let timeout;
  return function (...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), delay);
  };
}

elements.globalEmailSearch.addEventListener('input', function () {
  performGlobalSearch(this.value);
});

// Search suggestions
elements.globalEmailSearch.addEventListener('focus', function() {
  document.getElementById('searchSuggestions').classList.remove('hidden');
});

document.addEventListener('click', function(e) {
  if (!e.target.closest('#globalEmailSearch') && !e.target.closest('#searchSuggestions')) {
    document.getElementById('searchSuggestions').classList.add('hidden');
  }
});

// AI command handling
document.addEventListener('click', function(e) {
  if (e.target.closest('[data-command]')) {
    const command = e.target.closest('[data-command]').dataset.command;
    elements.globalEmailSearch.value = command;
    performGlobalSearch(command);
    document.getElementById('searchSuggestions').classList.add('hidden');
  }
});

// Smart file upload
document.getElementById('csvUpload').addEventListener('change', function () {
  const fileInput = this;
  const fileNameDisplay = document.getElementById('fileName');
  
  if (fileInput.files.length > 0) {
    const file = fileInput.files[0];
    fileNameDisplay.innerHTML = `<i class="ri-file-check-line mr-2 text-green-500"></i>${file.name}`;
  } else {
    fileNameDisplay.innerHTML = `<i class="ri-file-line mr-2"></i>No file selected`;
  }
});

document.getElementById('uploadCSV').addEventListener('click', function() {
  const fileInput = document.getElementById('csvUpload');
  const file = fileInput.files[0];
  
  if (!file) {
    showAlert('Please select a file to upload.', 'error');
    return;
  }
  
  const fileExtension = file.name.split('.').pop().toLowerCase();
  if (!['csv', 'txt', 'xlsx', 'xls'].includes(fileExtension)) {
    showAlert('Please upload a valid CSV, TXT, or Excel file.', 'error');
    return;
  }
  
  const uploadBtn = this;
  const originalBtnText = uploadBtn.innerHTML;
  uploadBtn.innerHTML = '<i class="ri-loader-4-line animate-spin"></i> Smart Processing...';
  uploadBtn.disabled = true;
  
  startProgress('Smart file processing');
  
  const reader = new FileReader();
  reader.onload = function(event) {
    const contents = event.target.result;
    
    // Smart email extraction
    const emailPattern = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g;
    const emailList = [];
    let match;
    
    while ((match = emailPattern.exec(contents)) !== null) {
      emailList.push(match[0]);
      
      if (emailList.length % 1000 === 0) {
        updateProgress((emailList.length / 20000) * 100);
      }
    }
    
    // Remove duplicates
    const uniqueEmails = [...new Set(emailList.map(e => e.toLowerCase()))];
    
    if (uniqueEmails.length > 0) {
      elements.recipientsInput.value = uniqueEmails.slice(0, 20000).join('\n');
      elements.recipientsInput.dispatchEvent(new Event('input'));
      showAlert(`🎉 Smart extraction complete! Found ${uniqueEmails.length} unique emails.`);
      addLiveActivity(`📁 Processed file: ${uniqueEmails.length} emails extracted`);
    } else {
      showAlert('No valid email addresses found in the file.', 'error');
    }
    
    setTimeout(() => {
      uploadBtn.innerHTML = originalBtnText;
      uploadBtn.disabled = false;
      endProgress();
    }, 500);
  };
  
  reader.readAsText(file);
});

// Quick Actions Toolbar
elements.toggleQuickActions.addEventListener('click', function() {
  const isShown = elements.quickActions.classList.contains('show');
  
  if (isShown) {
    elements.quickActions.classList.remove('show');
    elements.quickActionsIcon.classList.replace('ri-arrow-left-line', 'ri-arrow-right-line');
  } else {
    elements.quickActions.classList.add('show');
    elements.quickActionsIcon.classList.replace('ri-arrow-right-line', 'ri-arrow-left-line');
  }
});

// Quick action handlers
document.getElementById('quickSchedule').addEventListener('click', () => {
  elements.scheduleToggle.checked = !elements.scheduleToggle.checked;
  elements.scheduleToggle.dispatchEvent(new Event('change'));
});

document.getElementById('quickExport').addEventListener('click', () => {
  exportEmails('all');
});

document.getElementById('quickStats').addEventListener('click', () => {
  showQuickStats();
});

// Smart features
document.getElementById('smartExtract').addEventListener('click', function() {
  const content = elements.recipientsInput.value;
  if (!content.trim()) {
    showAlert('Please paste some content first.', 'warning');
    return;
  }
  
  this.innerHTML = '<i class="ri-loader-line animate-spin mr-1"></i> Extracting...';
  this.disabled = true;
  
  setTimeout(() => {
    const emailPattern = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g;
    const emails = [...new Set((content.match(emailPattern) || []).map(e => e.toLowerCase()))];
    
    if (emails.length > 0) {
      elements.recipientsInput.value = emails.join('\n');
      elements.recipientsInput.dispatchEvent(new Event('input'));
      showAlert(`Smart extraction complete! Found ${emails.length} unique emails.`);
    } else {
      showAlert('No valid emails found in the content.', 'error');
    }
    
    this.innerHTML = '<i class="ri-magic-line mr-1"></i> AI Smart Fix';
    this.disabled = false;
  }, 1000);
});

document.getElementById('clearRecipients').addEventListener('click', () => {
  elements.recipientsInput.value = '';
  elements.recipientsInput.dispatchEvent(new Event('input'));
  showAlert('Recipients cleared!');
});

document.getElementById('validateEmails').addEventListener('click', function() {
  const emails = elements.recipientsInput.value.split('\n').filter(e => e.trim());
  if (emails.length === 0) {
    showAlert('No emails to validate.', 'warning');
    return;
  }
  
  this.innerHTML = '<i class="ri-loader-line animate-spin mr-1"></i> Validating...';
  this.disabled = true;
  
  setTimeout(() => {
    let valid = 0, invalid = 0;
    const validEmails = [];
    
    emails.forEach(email => {
      email = email.trim();
      if (isValidEmail(email)) {
        valid++;
        validEmails.push(email);
      } else if (email) {
        invalid++;
      }
    });
    
    elements.recipientsInput.value = validEmails.join('\n');
    elements.recipientsInput.dispatchEvent(new Event('input'));
    
    showAlert(`Validation complete! Kept ${valid} valid emails, removed ${invalid} invalid ones.`);
    this.innerHTML = '<i class="ri-shield-check-line mr-1"></i> Validate';
    this.disabled = false;
  }, 1000);
});




// Advanced analysis features
document.getElementById('subjectAnalyzer').addEventListener('click', function() {
  const subject = elements.subjectInput.value.trim();
  if (!subject) {
    showAlert('Please enter a subject line first.', 'warning');
    return;
  }
  
  this.innerHTML = '<i class="ri-loader-line animate-spin mr-1"></i> Analyzing...';
  this.disabled = true;
  
  setTimeout(() => {
    const score = Math.floor(Math.random() * 30) + 70; // 70-99
    const suggestions = [
      'Consider adding personalization with {name}',
      'Question-based subjects often perform better',
      'Keep it under 50 characters for mobile',
      'Add urgency or curiosity elements'
    ];
    
    const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
    showAlert(`Subject Analysis: Score ${score}/100. Tip: ${randomSuggestion}`);
    
    this.innerHTML = '<i class="ri-search-eye-line mr-1"></i> Analyze';
    this.disabled = false;
  }, 1000);
});

document.getElementById('spamChecker').addEventListener('click', function() {
  const subject = elements.subjectInput.value.trim();
  const body = elements.bodyInput.value.trim();
  
  if (!subject && !body) {
    showAlert('Please enter subject and body text first.', 'warning');
    return;
  }
  
  this.innerHTML = '<i class="ri-loader-line animate-spin mr-1"></i> Checking...';
  this.disabled = true;
  
  setTimeout(() => {
    const spamWords = [
  // Money & Financial
  'free', '100% free', 'no cost', 'no fees', 'winner', 'winners', 'winning',
  'cash', 'earn money', 'extra income', 'double your income', 'financial freedom',
  'get paid', 'guaranteed', 'investment', 'make money', 'million', 'billion',
  'risk-free', 'save big', 'unsecured', 'instant earnings', 'fast cash',
  'credit card', 'eliminate debt', 'get out of debt', 'lower rates', 'pre-approved',
  'congratulations', 'you have been selected', 'hidden charges', 'lottery',
  'wealth', 'free trial', 'no obligation', 'no hidden costs', 'lowest price', 'money',

  // Urgency & Pressure
  'urgent', 'act now', 'apply now', 'limited time', 'once in a lifetime',
  'don’t delete', 'only today', 'expires', 'last chance', 'immediately',
  'respond now', 'time-sensitive', 'final notice', 'one time', 'while supplies last',
  'don’t miss out', 'deadline', 'today only', 'offer ends soon',

  // Sales & Marketing Hooks
  'buy direct', 'buy now', 'order now', 'shop now', 'get started',
  'special promotion', 'exclusive deal', 'lowest price', 'best price',
  'order today', 'new customers only', 'discount', 'offer expires',
  'call now', 'subscribe', 'join now', 'signup free', 'get access now',
  'start now', 'try now', 'free gift', 'limited offer', 'promotion', 'deal',
  'bonus', 'two for one', 'bulk email', 'increase sales', 'ad',

  // Health & Lifestyle
  'weight loss', 'burn fat', 'diet', 'miracle cure', 'no prescription',
  'online pharmacy', 'pills', 'supplement', 'viagra', 'cialis', 'meds',
  'enhancement', 'hair growth', 'anti-aging', 'lose weight', 'workout',
  'performance', 'enlargement', 'detox', 'cure', 'remedy',

  // Risky Guarantees
  '100% satisfied', 'money back', 'guaranteed results', 'lifetime access',
  'winner guaranteed', 'promise you', 'satisfaction guaranteed', 'instant results',
  'try risk free', 'no risk', 'results guaranteed', 'proven',

  // Scams & Manipulation
  'act immediately', 'avoid bankruptcy', 'be your own boss', 'big bucks',
  'call free', 'direct marketing', 'extra cash', 'get rich', 'home-based',
  'income from home', 'make $', 'multi-level marketing', 'no catch',
  'not spam', 'this isn’t junk', 'this isn’t spam', 'work from home',
  'amazing', 'unlimited', 'luxury', 'opportunity', 'apply now',
  'become a member', 'increase traffic', 'earn extra cash',

  // Misc High-Risk
  'click below', 'click here', 'unsubscribe', 'opt in', 'remove me',
  'winner alert', 'win big', 'don’t hesitate', 'compare rates',
  'as seen on', 'bargain', 'billions', 'cards accepted',
  'cheap', 'claims', 'clearance', 'collect', 'score',
  'no strings attached', 'passwords', 'trial', 'urgent offer',
  'work at home', 'zero cost', 'credit repair', 'double your',
  'be your own boss', 'freedom', 'apply online', 'fast loan',
  'pre-approved loan', 'instant approval', 'no credit check',
  'get started now', 'join millions', 'winner inside',
  'increase conversions', 'traffic boost'
];
    const content = (subject + ' ' + body).toLowerCase();
    const foundSpamWords = spamWords.filter(word => content.includes(word));
    
    if (foundSpamWords.length === 0) {
      showAlert('Spam Check: Excellent! No spam triggers detected.', 'success');
    } else {
      showAlert(`Spam Check: Warning! Found triggers: ${foundSpamWords.join(', ')}`, 'warning');
    }
    
    this.innerHTML = '<i class="ri-shield-line mr-1"></i> Spam Check';
    this.disabled = false;
  }, 1000);
});

// Preview and Test functionality
elements.previewEmail.addEventListener('click', () => {
  elements.previewModal.classList.remove('hidden');
});

elements.closePreviewModal.addEventListener('click', () => {
  elements.previewModal.classList.add('hidden');
});

elements.previewModal.addEventListener('click', e => {
  if (e.target === elements.previewModal) elements.previewModal.classList.add('hidden');
});

elements.updatePreview.addEventListener('click', updateEmailPreview);

function updateEmailPreview() {
  const previewEmail = elements.previewEmailInput.value.trim();
  if (!isValidEmail(previewEmail)) {
    showAlert('Please enter a valid preview email address.', 'error');
    return;
  }
  
  const name = extractNameFromEmail(previewEmail);
  const company = extractCompanyFromEmail(previewEmail);
  const subject = personalizeContent(elements.subjectInput.value, name, company);
  const body = personalizeContent(elements.bodyInput.value, name, company);
  
  elements.previewSubject.textContent = subject || 'No subject entered';
  elements.previewBody.textContent = body || 'No message body entered';
}

// Test email functionality
elements.sendTestEmail.addEventListener('click', () => {
  elements.testEmailModal.classList.remove('hidden');
});

elements.closeTestModal.addEventListener('click', () => {
  elements.testEmailModal.classList.add('hidden');
});

elements.testEmailModal.addEventListener('click', e => {
  if (e.target === elements.testEmailModal) elements.testEmailModal.classList.add('hidden');
});

elements.confirmSendTest.addEventListener('click', () => {
  const testEmail = elements.testEmailAddress.value.trim();
  if (!isValidEmail(testEmail)) {
    showAlert('Please enter a valid test email address.', 'error');
    return;
  }
  
  const name = extractNameFromEmail(testEmail);
  const company = extractCompanyFromEmail(testEmail);
  const personalizedSubject = encodeURIComponent(personalizeContent(elements.subjectInput.value, name, company));
  const personalizedBody = encodeURIComponent(personalizeContent(elements.bodyInput.value, name, company)).replace(/\n/g, '%0D%0A');
  const mailto = `mailto:${testEmail}?subject=${personalizedSubject}&body=${personalizedBody}`;
  
  window.open(mailto, '_blank');
  showAlert('Test email opened in your default email client!');
  elements.testEmailModal.classList.add('hidden');
  addLiveActivity(`Test email sent to ${testEmail}`);
});

// Theme management
const darkModeToggle = document.getElementById('darkModeToggle');
const themeMenu = document.getElementById('themeMenu');
const darkIcon = document.getElementById('darkIcon');
const lightIcon = document.getElementById('lightIcon');

function applyTheme(theme) {
  if (theme === 'dark') {
    document.documentElement.classList.add('dark');
    document.body.classList.add('dark-custom-bg', 'text-white');
    darkIcon.classList.remove('hidden');
    lightIcon.classList.add('hidden');
  } else if (theme === 'light') {
    document.documentElement.classList.remove('dark');
    document.body.classList.remove('dark-custom-bg', 'text-white');
    darkIcon.classList.add('hidden');
    lightIcon.classList.remove('hidden');
  } else {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(prefersDark ? 'dark' : 'light');
  }
}

function saveTheme(theme) {
  localStorage.setItem('theme', theme);
}

function loadTheme() {
  const savedTheme = localStorage.getItem('theme') || 'system';
  applyTheme(savedTheme);
}

darkModeToggle.addEventListener('click', () => {
  const isVisible = themeMenu.classList.contains('opacity-100');
  themeMenu.classList.toggle('opacity-100', !isVisible);
  themeMenu.classList.toggle('invisible', isVisible);
});

themeMenu.addEventListener('click', (e) => {
  const selectedTheme = e.target.closest('[data-theme]')?.getAttribute('data-theme');
  if (selectedTheme) {
    saveTheme(selectedTheme);
    applyTheme(selectedTheme);
    themeMenu.classList.add('invisible');
    themeMenu.classList.remove('opacity-100');
  }
});

loadTheme();

document.addEventListener('click', (e) => {
  if (!e.target.closest('#darkModeToggle') && !e.target.closest('#themeMenu')) {
    themeMenu.classList.add('invisible');
    themeMenu.classList.remove('opacity-100');
  }
});

// Email actions menu
elements.emailActionsBtn.addEventListener('click', function() {
  elements.emailActionsMenu.classList.toggle('hidden');
});

document.addEventListener('click', function(e) {
  if (!elements.emailActionsBtn.contains(e.target) && !elements.emailActionsMenu.contains(e.target)) {
    elements.emailActionsMenu.classList.add('hidden');
  }
});

// Action button functionality
document.getElementById('clearHistory').addEventListener('click', function() {
  if (confirm('Clear your sent email history? This action can be undone within 10 seconds.')) {
  lastClearedHistory = new Set(allTimeSent);  // Already renamed
  localStorage.removeItem('allTimeSent');
  allTimeSent.clear();
  
  // Reset 24h tracker too
  recentSends = [];
  localStorage.removeItem('recentSends');
  update24hDisplay();
  
  const emailLinks = document.querySelectorAll('#generatedLinks a');
  emailLinks.forEach(link => {
    link.style.color = '';
  });
  
  updateCounters();
  updateAnalytics();
  showAlert('History cleared! Click Undo to restore.', 'warning');
  elements.emailActionsMenu.classList.add('hidden');
  addLiveActivity('History cleared by user');
  
  
    // Show undo button
    const undoBtn = document.createElement('button');
    undoBtn.className = 'fixed bottom-5 right-20 bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg shadow-lg z-50 transition-colors';
    undoBtn.innerHTML = '<i class="ri-arrow-go-back-line mr-1"></i> Undo Clear';
    undoBtn.onclick = () => {
      allTimeSent = lastClearedHistory;
      localStorage.setItem('allTimeSent', JSON.stringify([...allTimeSent]));
      emailLinks.forEach(link => {
        const email = link.textContent.split('. ')[1];
        if (allTimeSent.has(email)) {
          link.style.color = 'orange';
        } else {
          link.style.color = '';
        }
      });
      updateCounters();
      updateAnalytics();
      showAlert('History restored successfully!');
      addLiveActivity('History restored by user');
      undoBtn.remove();
      lastClearedHistory = null;
    };
    document.body.appendChild(undoBtn);
    
    setTimeout(() => {
      if (undoBtn.parentNode) undoBtn.remove();
      lastClearedHistory = null;
    }, 10000);
  }
});

document.getElementById('copyEmails').addEventListener('click', function() {
  const emailLinks = document.querySelectorAll('#generatedLinks a');
  const emails = Array.from(emailLinks).map(link => {
    return link.innerText.split('. ')[1];
  });
  
  if (emails.length > 0) {
    navigator.clipboard.writeText(emails.join('\n'))
      .then(() => {
        showAlert(`Copied ${emails.length} email addresses to clipboard!`);
        addLiveActivity(`Copied ${emails.length} emails to clipboard`);
      })
      .catch(err => {
        showAlert('Failed to copy emails. Please try again.', 'error');
      });
  } else {
    showAlert('No emails to copy!', 'warning');
  }
  elements.emailActionsMenu.classList.add('hidden');
});

function exportEmails(filterType) {
  const emailLinks = document.querySelectorAll('#generatedLinks a');
  const emails = [];
  
  emailLinks.forEach(link => {
    const email = link.innerText.split('. ')[1];
    const isSent = link.style.color === 'orange';
    
    if ((filterType === 'all') || 
        (filterType === 'sent' && isSent) || 
        (filterType === 'remaining' && !isSent) || 
        (filterType === 'selected' && selectedEmails.has(email))) {
      emails.push(email);
    }
  });
  
  if (emails.length > 0) {
    const timestamp = new Date().toISOString().split('T')[0];
    const blob = new Blob([emails.join('\n')], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `hbeebuzz-${filterType}-emails-${timestamp}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showAlert(`Exported ${emails.length} email addresses!`);
    addLiveActivity(`Exported ${emails.length} ${filterType} emails`);
  } else {
    showAlert('No emails to export!', 'warning');
  }
  elements.emailActionsMenu.classList.add('hidden');
}

document.getElementById('exportAll').addEventListener('click', () => exportEmails('all'));
document.getElementById('exportRemaining').addEventListener('click', () => exportEmails('remaining'));
document.getElementById('exportSelected').addEventListener('click', () => exportEmails('selected'));

// Scroll functionality
let scrollTimeout;
window.addEventListener('scroll', function() {
  clearTimeout(scrollTimeout);
  scrollTimeout = setTimeout(() => {
    elements.scrollTopBtn.classList.toggle('visible', window.pageYOffset > 300);
  }, 100);
});

elements.scrollTopBtn.addEventListener('click', function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

document.getElementById('scrollToForm').addEventListener('click', function() {
  elements.emailForm.scrollIntoView({ behavior: 'smooth' });
});

// Template modal functionality
elements.addTemplateBtn.addEventListener('click', function() {
  const customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
  if (customTemplates.length >= 3) {
    showAlert('Maximum of 3 custom templates allowed. Delete an existing template first.', 'warning');
    return;
  }
  elements.templateModal.classList.remove('hidden');
});

elements.closeTemplateModal.addEventListener('click', function() {
  elements.templateModal.classList.add('hidden');
});

elements.templateModal.addEventListener('click', function(e) {
  if (e.target === elements.templateModal) {
    elements.templateModal.classList.add('hidden');
  }
});

elements.saveTemplate.addEventListener('click', function() {
  const name = document.getElementById('templateName').value;
  const subject = document.getElementById('templateSubject').value;
  const body = document.getElementById('templateBody').value;
  const category = document.getElementById('templateCategory').value;
  
  if (!name || !subject || !body) {
    showAlert('Please fill in all template fields.', 'error');
    return;
  }
  
  const templates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
  if (templates.length >= 3) {
    showAlert('Maximum of 3 custom templates allowed.', 'error');
    return;
  }
  
  templates.push({ name, subject, body, category, id: Date.now() });
  localStorage.setItem('customTemplates', JSON.stringify(templates));
  
  loadCustomTemplates();
  showAlert('Custom template saved successfully!');
  elements.templateModal.classList.add('hidden');
  addLiveActivity(`Created custom template: ${name}`);
  
  // Clear form
  document.getElementById('templateName').value = '';
  document.getElementById('templateSubject').value = '';
  document.getElementById('templateBody').value = '';
});

function loadCustomTemplates() {
  const customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
  
  const existingCustom = elements.templatesContainer.querySelectorAll('.custom-template');
  existingCustom.forEach(template => template.remove());
  
  customTemplates.slice(0, 3).forEach(template => {
    const templateElement = document.createElement('div');
    templateElement.className = 'border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-blue-300 dark:hover:border-blue-700 transition-all cursor-pointer custom-template bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20';
    templateElement.setAttribute('data-template-subject', template.subject);
    templateElement.setAttribute('data-template-body', template.body);
    
    templateElement.innerHTML = `
      <div class="flex justify-between items-start mb-2">
        <h5 class="font-medium text-gray-800 dark:text-gray-200">${template.name}</h5>
        <div class="flex items-center gap-2">
          <span class="text-xs bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300 px-2 py-0.5 rounded">${template.category}</span>
          <button class="delete-template text-red-500 hover:text-red-700 text-xs" data-template-id="${template.id}">
            <i class="ri-delete-bin-line"></i>
          </button>
        </div>
      </div>
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-3 line-clamp-2">Custom template created by you</p>
      <button class="text-xs text-blue-500 hover:text-blue-700 dark:hover:text-blue-300 flex items-center">
        <i class="ri-add-line mr-1"></i> Use Template
      </button>
    `;
    
    elements.templatesContainer.appendChild(templateElement);
  });
}

document.addEventListener('click', function(e) {
  if (e.target.closest('.delete-template')) {
    e.stopPropagation();
    const templateId = e.target.closest('.delete-template').dataset.templateId;
    
    if (confirm('Delete this custom template?')) {
      let customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
      customTemplates = customTemplates.filter(template => template.id != templateId);
      localStorage.setItem('customTemplates', JSON.stringify(customTemplates));
      
      loadCustomTemplates();
      showAlert('Template deleted successfully!');
      addLiveActivity('Custom template deleted');
    }
  }
});

// Utility functions
function startProgress(taskName) {
  elements.globalProgressBar.classList.add('show');
  elements.globalProgressInner.style.width = '0%';
}

function updateProgress(percent) {
  elements.globalProgressInner.style.width = `${Math.min(percent, 100)}%`;
}

function endProgress() {
  updateProgress(100);
  setTimeout(() => {
    elements.globalProgressBar.classList.remove('show');
  }, 500);
}

function showAlert(message, type = 'success') {
  const alertBox = document.createElement('div');
  
  let bgColor = 'bg-green-500';
  let icon = 'ri-check-line';
  
  if (type === 'error') {
    bgColor = 'bg-red-500';
    icon = 'ri-error-warning-line';
  } else if (type === 'warning') {
    bgColor = 'bg-yellow-500';
    icon = 'ri-alert-line';
  }
  
  alertBox.className = `alert-box fixed top-5 right-5 left-5 ${bgColor} text-white py-3 px-4 rounded-lg shadow-lg transform transition-all opacity-0 animate-fadeIn z-50 max-w-md mx-auto`;
  alertBox.innerHTML = `
    <div class="flex items-center space-x-2">
      <i class="${icon}"></i>
      <span>${message}</span>
    </div>
  `;

  document.body.appendChild(alertBox);

  requestAnimationFrame(() => {
    alertBox.classList.remove('opacity-0');
    alertBox.classList.add('opacity-100');
  });

  setTimeout(() => {
    alertBox.classList.add('opacity-0');
    setTimeout(() => {
      if (alertBox.parentNode) {
        alertBox.remove();
      }
    }, 200);
  }, 3000);
}

function showQuickStats() {
    const total = allGeneratedEmails.length;
    const sent = allTimeSent.size;
    const remaining = total - sent;
    const topDomain = Object.entries(domainStats).sort(([,a], [,b]) => b - a)[0];
    
    const statsMessage = `
📊 Campaign Statistics:
• Total Emails: ${total}
• Sent: ${sent}
• Remaining: ${remaining}
• Top Domain: ${topDomain ? `${topDomain[0]} (${topDomain[1]})` : 'N/A'}
• Completion: ${total > 0 ? Math.round((sent/total)*100) : 0}%
    `;
    
    showAlert(statsMessage.trim(), 'info');
}


// Filter emails by domain
function filterByDomain(domain) {
    const emailLinks = document.querySelectorAll('#generatedLinks a');
    let foundAny = false;

    emailLinks.forEach(link => {
        const email = link.textContent.split('. ')[1];
        const linkDomain = email.split('@')[1];
        const match = linkDomain.toLowerCase().includes(domain.toLowerCase());
        foundAny = foundAny || match;
        
        const isSent = allTimeSent.has(email);
        
        let shouldShow = match;
        if (currentFilter === 'sent' && !isSent) shouldShow = false;
        if (currentFilter === 'pending' && isSent) shouldShow = false;
        
        link.style.display = shouldShow ? 'block' : 'none';
        link.style.backgroundColor = match ? 'rgba(74, 222, 128, 0.1)' : '';
    });

    if (!foundAny) {
        showAlert(`No emails found for domain: ${domain}`, 'warning');
    }
}

// Sort emails by domain
function sortEmails(sortType) {
    if (sortType === 'domain') {
        const container = document.getElementById('generatedLinks');
        const emailLinks = Array.from(container.querySelectorAll('a'));
        
        emailLinks.sort((a, b) => {
            const emailA = a.textContent.split('. ')[1];
            const emailB = b.textContent.split('. ')[1];
            const domainA = emailA.split('@')[1];
            const domainB = emailB.split('@')[1];
            return domainA.localeCompare(domainB);
        });
        
        // Clear the container
        container.innerHTML = '';
        
        // Append sorted links
        emailLinks.forEach(link => container.appendChild(link));
        
        showAlert('Emails sorted by domain!');
    }
}

// Reset templates functionality
document.getElementById('resetTemplates')?.addEventListener('click', function() {
    if (confirm('Reset all templates to default? This will remove your custom templates.')) {
        localStorage.removeItem('customTemplates');
        loadCustomTemplates();
        showAlert('Templates reset to default!', 'success');
        addLiveActivity('Templates reset to default');
    }
});

// Reset app functionality
document.getElementById('reset-app')?.addEventListener('click', function() {
    if (confirm('Are you sure you want to reset the entire campaign? This will clear all your data and progress. This action is not reversible. Are you sure you want to proceed?')) {
    // Clear form fields
    elements.recipientsInput.value = '';
    elements.subjectInput.value = '';
    elements.bodyInput.value = '';
    
    // Reset counters
    document.getElementById('validEmails').textContent = '0';
    document.getElementById('invalidEmails').textContent = '0';
    document.getElementById('totalEmails').textContent = '0';
    document.getElementById('duplicateEmails').textContent = '0';
    
    // Clear generated emails
    allGeneratedEmails = [];
    allTimeSent.clear();
    
    // Reset 24h tracker too
    recentSends = [];
    localStorage.removeItem('recentSends');
    update24hDisplay();
    
    document.getElementById('generatedLinks').innerHTML = '';
    document.getElementById('mailtoLinks').classList.add('hidden');
    document.getElementById('emptyState').classList.remove('hidden');
    
    // Reset analytics
    updateCounters();
    updateAnalytics();
    
       showAlert('Campaign reset successfully!', 'success');
    addLiveActivity('Campaign reset by user');
    }  // <-- ADD THIS: Close the if (confirm) block
  }  // <-- ADD THIS: Close the addEventListener function
);  // <-- The ?.addEventListener ends here (already present, but ensure semicolon)

// New: Load and clean 24h tracker
function init24hTracker() {
  // Load all-time sent
  const savedAllTime = localStorage.getItem('allTimeSent');
  if (savedAllTime) {
    allTimeSent = new Set(JSON.parse(savedAllTime));
  }
  
  // Load recent sends and auto-clean old ones (>24h)
  const savedRecent = localStorage.getItem('recentSends') || '[]';
  recentSends = JSON.parse(savedRecent).filter(item => item.timestamp > Date.now() - 86400000);  // 24h in ms
  localStorage.setItem('recentSends', JSON.stringify(recentSends));
  
  update24hDisplay();  // Initial update
}

// Call it in init
init24hTracker();

// Initialize everything
loadCustomTemplates();
updateCounters();
updateAnalytics();
update24hDisplay();  // <-- ADD: Ensure 24h sync on load
elements.recipientsInput.dispatchEvent(new Event('input'));
addLiveActivity('HbeeBuzz PWA initialized - Ready for lightning-fast email outreach!');

// Performance monitoring
let perfTimer = setInterval(() => {
  const score = Math.floor(Math.random() * 5) + 95; // 95-99 for demo
  document.getElementById('perfScore').textContent = score;
}, 5000);
 </script>     


<!-- 'It is your responsibility to notify your visitors about cookies used and data collected on your blog. Blogger makes a standard notification available for you to use on your blog, and you can customise it or replace it with your own notice. See http://www.blogger.com/go/cookiechoices for more details.' -->
<script src="/js/cookienotice.js" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function(event) {
    window.cookieChoices && cookieChoices.showCookieConsentBar && cookieChoices.showCookieConsentBar(
        (window.cookieOptions && cookieOptions.msg) || 'This site uses cookies from Google to deliver its services and to analyse traffic. Your IP address and user agent are shared with Google, together with performance and security metrics, to ensure quality of service, generate usage statistics and to detect and address abuse.',
        (window.cookieOptions && cookieOptions.close) || 'Got it',
        (window.cookieOptions && cookieOptions.learn) || 'Learn more',
        (window.cookieOptions && cookieOptions.link) || 'https://www.blogger.com/go/blogspot-cookies');
  });
</script>

<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"3c444da3cd804f848f99706ed426dbf6","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>

  <!-- HbeeBuzz Modal Root for v2 -->
  <div id="hbeebuzzModalRoot" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/40 backdrop-blur"></div>
    <div class="relative bg-white rounded-2xl shadow-lg max-w-2xl w-full mx-4 z-10 overflow-hidden">
      <div class="p-4 border-b flex items-center justify-between">
        <h3 id="hbeebuzzModalTitle" class="font-semibold">Modal</h3>
        <button id="hbeebuzzModalClose" class="text-gray-500 hover:text-gray-700"><i class="ri-close-line text-xl"></i></button>
      </div>
      <div id="hbeebuzzModalBody" class="p-4 text-sm text-gray-700 max-h-96 overflow-auto"></div>
      <div class="p-4 border-t flex justify-end gap-2 bg-gray-50">
        <button id="hbeebuzzModalCancel" class="px-4 py-2 rounded-lg border">Close</button>
        <button id="hbeebuzzModalPrimary" class="px-4 py-2 rounded-lg bg-blue-600 text-white">OK</button>
      </div>
    </div>
  </div>
</body>

</html>
<script>
// V2 composer logic integrated
(function(){
  // helpers
  const qs = (s, el=document) => el.querySelector(s);
  // Elements
  const recipientsEl = qs('#recipients');
  const subjectEl = qs('#subject');
  const bodyText = qs('#bodyText');
  const bodyCode = qs('#bodyCode');
  const bodyPreview = qs('#bodyPreview');
  const bodyValue = qs('#bodyValue');
  const bodyCharCount = qs('#bodyCharCount');
  const tabText = qs('#tabText');
  const tabCode = qs('#tabCode');
  const tabPreview = qs('#tabPreview');
  const insertTemplate = qs('#insertTemplate');
  const generateBtn = qs('#previewEmail') || qs('#generateBtn') || qs('#previewEmailBtn') || qs('#previewEmail');
  const previewBtn = qs('#previewBtn');
  const testBtn = qs('#sendTestEmail') || qs('#testBtn');
  const sendBtn = qs('#sendBtn');
  // Modal elements (hbeebuzz)
  const modalRoot = qs('#hbeebuzzModalRoot');
  const modalTitle = qs('#hbeebuzzModalTitle');
  const modalBody = qs('#hbeebuzzModalBody');
  const modalClose = qs('#hbeebuzzModalClose');
  const modalCancel = qs('#hbeebuzzModalCancel');
  const modalPrimary = qs('#hbeebuzzModalPrimary');
  // Persistence
  const STORAGE_KEY = 'hbeebuzz_full_v2_state_v1';
  function saveState(){
    const state = { recipients: recipientsEl?recipientsEl.value:'', subject: subjectEl?subjectEl.value:'', bodyText: bodyText?bodyText.value:'', bodyCode: bodyCode?bodyCode.value:'', activeMode: getActiveMode() };
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e){}
  }
  function loadState(){ try{ const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return; const s=JSON.parse(raw); if(recipientsEl) recipientsEl.value=s.recipients||''; if(subjectEl) subjectEl.value=s.subject||''; if(bodyText) bodyText.value=s.bodyText||''; if(bodyCode) bodyCode.value=s.bodyCode||''; setMode(s.activeMode||'text', false); updateCounts(); }catch(e){console.warn(e);} }
  // Modal helpers
  function openModal(title, html, primaryLabel='OK', onPrimary=null){ if(!modalRoot) return; modalTitle.textContent=title; modalBody.innerHTML=html; modalPrimary.textContent=primaryLabel; modalRoot.classList.remove('hidden'); modalPrimary.onclick=()=>{ if(onPrimary) onPrimary(); closeModal(); }; modalCancel.onclick=closeModal; modalClose.onclick=closeModal; }
  function closeModal(){ if(!modalRoot) return; modalRoot.classList.add('hidden'); modalPrimary.onclick=null; modalCancel.onclick=null; modalClose.onclick=null; }
  // Email helpers
  function parseRecipients(raw){ if(!raw) return []; return raw.split(/\r?\n/).map(r=>r.trim()).filter(x=>x); }
  function validateEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }
  // Mode management
  function getActiveMode(){ if(!bodyText || !bodyCode || !bodyPreview) return 'text'; if(!bodyText.classList.contains('hidden')) return 'text'; if(!bodyCode.classList.contains('hidden')) return 'code'; if(!bodyPreview.classList.contains('hidden')) return 'preview'; return 'text'; }
  function setMode(mode, focus=true){ [tabText, tabCode, tabPreview].forEach(t=> t && t.classList.remove('bg-white','text-gray-900','shadow-sm')); if(bodyText) bodyText.classList.add('hidden'); if(bodyCode) bodyCode.classList.add('hidden'); if(bodyPreview) bodyPreview.classList.add('hidden'); if(mode==='text'){ tabText && tabText.classList.add('bg-white','text-gray-900','shadow-sm'); bodyText && bodyText.classList.remove('hidden'); if(focus) bodyText.focus(); } else if(mode==='code'){ tabCode && tabCode.classList.add('bg-white','text-gray-900','shadow-sm'); bodyCode && bodyCode.classList.remove('hidden'); if(focus) bodyCode.focus(); } else if(mode==='preview'){ tabPreview && tabPreview.classList.add('bg-white','text-gray-900','shadow-sm'); const code = bodyCode?bodyCode.value.trim():''; if(code){ bodyPreview && (bodyPreview.innerHTML = code); } else { const escaped = bodyText?bodyText.value.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') : ''; bodyPreview && (bodyPreview.innerHTML = '<div style="white-space:pre-wrap;">'+escaped+'</div>'); } bodyPreview && bodyPreview.classList.remove('hidden'); } saveState(); }
  // counts
  function updateCounts(){ const body = getComposedBody(); bodyCharCount && (bodyCharCount.textContent = (body||'').length + ' chars'); const recs = recipientsEl?parseRecipients(recipientsEl.value):[]; const rem = qs('#remainingCounter') || qs('#remainingCounter') || qs('#remainingCounter') || qs('#remainingCounter') ; if(qs('#remainingCounter')) qs('#remainingCounter').textContent = recs.length; if(qs('#remainingCounter')) qs('#remainingCounter').textContent = recs.length; const sentEl = qs('#sentCounter') || qs('#countSent') || qs('#sentCounter'); if(sentEl) sentEl.textContent = localStorage.getItem('hbeebuzz_demo_sent')||'0'; }
  function getComposedBody(){ if(bodyCode && bodyCode.value.trim()) return bodyCode.value; return bodyText?bodyText.value:''; }
  // events
  tabText && tabText.addEventListener('click', ()=> setMode('text')); tabCode && tabCode.addEventListener('click', ()=> setMode('code')); tabPreview && tabPreview.addEventListener('click', ()=> setMode('preview'));
  [recipientsEl, subjectEl, bodyText, bodyCode].forEach(el=>{ if(el) el.addEventListener('input', ()=>{ saveState(); updateCounts(); }); });
  qs('#clearRecipients') && qs('#clearRecipients').addEventListener('click', ()=>{ if(recipientsEl) recipientsEl.value=''; saveState(); updateCounts(); });
  qs('#validateEmails') && qs('#validateEmails').addEventListener('click', ()=>{ const recs = parseRecipients(recipientsEl?recipientsEl.value:''); if(recs.length===0){ openModal('Validation','No recipients found.'); return; } const invalid = recs.filter(r=> !validateEmail(r)); openModal('Validation','<div><strong>Total:</strong> '+recs.length+'</div><div><strong>Invalid:</strong> '+invalid.length+'</div><div class=\"mt-2 text-xs text-gray-500\">Invalid samples: <pre>'+ (invalid.slice(0,10).join('\\n')||'None') +'</pre></div>'); });
  insertTemplate && insertTemplate.addEventListener('click', ()=>{ const tpl = "<p>Hi {name},</p><p>I hope this finds you well. I'd love to speak about a collaboration opportunity.</p><p>Best,<br/>[Your Name]</p>"; const mode = getActiveMode(); if(mode==='code'){ bodyCode.value = (bodyCode.value||'') + "\\n" + tpl; setMode('code'); } else { bodyText.value = (bodyText.value||'') + "\\n\\n" + "Hi {name},\\n\\nI hope this finds you well. I'd love to speak about a collaboration opportunity.\\n\\nBest,\\n[Your Name]"; setMode('text'); } saveState(); updateCounts(); });
  // actions - try multiple selectors where original file may have different ids
  (generateBtn) && generateBtn.addEventListener('click', ()=>{ const recs = parseRecipients(recipientsEl?recipientsEl.value:''); if(recs.length===0){ openModal('Generate','No recipients to generate for.'); return; } const body = getComposedBody(); const subj = subjectEl?subjectEl.value:'(no subject)'; const sample = '<div class=\"p-2 bg-gray-50 rounded\"><strong>Subject:</strong> '+subj+'<hr/>' + '<div>' + (bodyCode && bodyCode.value.trim()? body : ('<pre style=\"white-space:pre-wrap;\">'+escapeHtml(body) +'</pre>')) + '</div></div>'; openModal('Generated '+recs.length+' emails', sample, 'OK', ()=>{}); });
  (previewBtn) && previewBtn.addEventListener('click', ()=>{ const body = getComposedBody(); const content = '<div><strong>To:</strong> ' + (recipientsEl?parseRecipients(recipientsEl.value).slice(0,10).join(', '):'') + '</div>' + '<div class=\"mt-2\"><strong>Subject:</strong> ' + (subjectEl?escapeHtml(subjectEl.value||''):'') + '</div>' + '<hr/>' + (bodyCode && bodyCode.value.trim()? body : '<pre style=\"white-space:pre-wrap;\">'+escapeHtml(body)+'</pre>'); openModal('Preview', content, 'Close'); });
  (testBtn) && testBtn.addEventListener('click', ()=>{ const recs = parseRecipients(recipientsEl?recipientsEl.value:''); if(recs.length===0){ openModal('Test','No recipients to test.'); return; } const body = getComposedBody(); const mailto = 'mailto:' + encodeURIComponent(recs[0]) + '?subject=' + encodeURIComponent(subjectEl?subjectEl.value||'':'') + '&body=' + encodeURIComponent(body.replace(/<\/?[^>]+(>|$)/g, '')); openModal('Test Email', '<div><strong>Test recipient:</strong> '+escapeHtml(recs[0])+'</div><div class=\"mt-2 text-xs text-gray-500\">This is a demo. You can open your mail client for the first address.</div>', 'Open Mail', ()=>{ window.location.href = mailto; }); });
  (sendBtn) && sendBtn.addEventListener('click', ()=>{ const recs = parseRecipients(recipientsEl?recipientsEl.value:''); if(recs.length===0){ openModal('Send','No recipients to send to.'); return; } const prev = parseInt(localStorage.getItem('hbeebuzz_demo_sent')||'0',10); localStorage.setItem('hbeebuzz_demo_sent', String(prev + recs.length)); updateCounts(); openModal('Sent (Demo)','<div>Successfully <strong>queued</strong> '+recs.length+' emails in demo mode.<div class=\"mt-2 text-xs text-gray-500\">No real emails were sent.</div></div>'); });
  function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  document.addEventListener('DOMContentLoaded', ()=>{ loadState(); updateCounts(); setMode(getActiveMode()); if(window.location.hash==='#preview') setMode('preview'); });
  window.addEventListener('beforeunload', ()=> saveState());
})();</script>
</body>
